# BlockSuite åˆ—å¸ƒå±€ç»„ä»¶è®¾è®¡æ–‡æ¡£

## ğŸ¨ ç»„ä»¶è®¾è®¡æ¦‚è§ˆ

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†BlockSuiteåˆ—å¸ƒå±€ç³»ç»Ÿä¸­æ‰€æœ‰UIç»„ä»¶çš„è®¾è®¡è§„èŒƒã€äº¤äº’é€»è¾‘ã€æ ·å¼ç³»ç»Ÿå’Œä½¿ç”¨æŒ‡å—ã€‚

## ğŸ—ï¸ ç»„ä»¶æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Layout Container                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                Layout Switcher                          â”‚ â”‚
â”‚  â”‚  [â–Š] [â–Šâ–Š] [â–Šâ–Šâ–Š] [â–Šâ–Šâ–Šâ–Š] [â–Šâ–Šâ–Šâ–Šâ–Š]                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                Layout Renderer                          â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚
â”‚  â”‚  â”‚Column 1 â”‚ â”‚Column 2 â”‚ â”‚Column 3 â”‚ â”‚Column 4 â”‚     â”‚ â”‚
â”‚  â”‚  â”‚         â”‚ â”‚         â”‚ â”‚         â”‚ â”‚         â”‚     â”‚ â”‚
â”‚  â”‚  â”‚Block A  â”‚ â”‚Block B  â”‚ â”‚Block E  â”‚ â”‚Block F  â”‚     â”‚ â”‚
â”‚  â”‚  â”‚Block C  â”‚ â”‚Block D  â”‚ â”‚         â”‚ â”‚         â”‚     â”‚ â”‚
â”‚  â”‚  â”‚         â”‚ â”‚         â”‚ â”‚         â”‚ â”‚         â”‚     â”‚ â”‚
â”‚  â”‚  â”‚   [+]   â”‚ â”‚   [+]   â”‚ â”‚   [+]   â”‚ â”‚   [+]   â”‚     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“± æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 1. LayoutSwitcher (å¸ƒå±€åˆ‡æ¢å™¨)

#### ğŸ¯ è®¾è®¡ç›®æ ‡
- **ç›´è§‚æ˜“ç”¨**: ä¸€ç›®äº†ç„¶çš„å›¾æ ‡è®¾è®¡
- **å¿«é€Ÿå“åº”**: ç‚¹å‡»å³æ—¶åˆ‡æ¢ï¼Œæµç•…åŠ¨ç”»
- **çŠ¶æ€æ¸…æ™°**: å½“å‰æ¨¡å¼æ˜ç¡®é«˜äº®
- **é€‚åº”æ€§å¼º**: æ”¯æŒå¤šç§å°ºå¯¸å’Œæ’åˆ—æ–¹å¼

#### ğŸ–¼ï¸ è§†è§‰è®¾è®¡

##### é»˜è®¤çŠ¶æ€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â–Š]  [â–Šâ–Š]  [â–Šâ–Šâ–Š]  [â–Šâ–Šâ–Šâ–Š]  [â–Šâ–Šâ–Šâ–Šâ–Š]               â”‚
â”‚ å•åˆ—   åŒåˆ—   ä¸‰åˆ—    å››åˆ—     äº”åˆ—                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### æ¿€æ´»çŠ¶æ€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â–Š]  [â–Šâ–Š]  ã€â–Šâ–Šâ–Šã€‘  [â–Šâ–Šâ–Šâ–Š]  [â–Šâ–Šâ–Šâ–Šâ–Š]             â”‚
â”‚ å•åˆ—   åŒåˆ—   âœ“ä¸‰åˆ—    å››åˆ—     äº”åˆ—                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### ç¦ç”¨çŠ¶æ€ (å“åº”å¼é™åˆ¶)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â–Š]  [â–Šâ–Š]  [â–Šâ–Šâ–Š]  [â–‘â–‘â–‘â–‘]  [â–‘â–‘â–‘â–‘â–‘]               â”‚
â”‚ å•åˆ—   åŒåˆ—   ä¸‰åˆ—   (ç¦ç”¨)   (ç¦ç”¨)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ¨ æ ·å¼è§„èŒƒ

```css
/* ç»„ä»¶å®¹å™¨ */
.layout-switcher {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: var(--affine-background-secondary-color);
  border-radius: 8px;
  border: 1px solid var(--affine-border-color);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  transition: box-shadow 0.2s ease;
}

.layout-switcher:hover {
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

/* å¸ƒå±€æŒ‰é’® */
.layout-button {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  border: 2px solid transparent;
  border-radius: 8px;
  background: transparent;
  cursor: pointer;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  color: var(--affine-icon-color);
  font-size: 12px;
  font-weight: 500;
}

/* æŒ‰é’®å›¾æ ‡ */
.layout-icon {
  font-size: 16px;
  margin-bottom: 2px;
  transition: transform 0.2s ease;
}

/* æŒ‰é’®æ ‡ç­¾ */
.layout-label {
  font-size: 10px;
  opacity: 0.8;
  white-space: nowrap;
}

/* æ‚¬åœçŠ¶æ€ */
.layout-button:hover {
  background: var(--affine-hover-color);
  border-color: var(--affine-primary-color-alpha);
  transform: translateY(-1px);
}

.layout-button:hover .layout-icon {
  transform: scale(1.1);
  color: var(--affine-primary-color);
}

/* æ¿€æ´»çŠ¶æ€ */
.layout-button.active {
  background: var(--affine-primary-color);
  color: white;
  border-color: var(--affine-primary-color);
}

.layout-button.active .layout-icon {
  color: white;
}

.layout-button.active::after {
  content: "âœ“";
  position: absolute;
  bottom: 2px;
  right: 2px;
  font-size: 8px;
}

/* ç¦ç”¨çŠ¶æ€ */
.layout-button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
  background: var(--affine-background-disabled);
  color: var(--affine-text-disabled);
}

.layout-button:disabled:hover {
  transform: none;
  border-color: transparent;
}

/* åŠ è½½çŠ¶æ€ */
.layout-button.loading {
  position: relative;
  pointer-events: none;
}

.layout-button.loading::before {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  width: 16px;
  height: 16px;
  margin: -8px 0 0 -8px;
  border: 2px solid transparent;
  border-top: 2px solid currentColor;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}
```

#### ğŸ“± å“åº”å¼è®¾è®¡

```css
/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width: 768px) {
  .layout-switcher {
    padding: 4px 8px;
    gap: 4px;
  }
  
  .layout-button {
    width: 36px;
    height: 36px;
  }
  
  .layout-label {
    display: none; /* ç§»åŠ¨ç«¯éšè—æ ‡ç­¾ */
  }
}

/* ç´§å‡‘æ¨¡å¼ */
.layout-switcher.compact {
  padding: 4px 6px;
  gap: 2px;
}

.layout-switcher.compact .layout-button {
  width: 32px;
  height: 32px;
}

/* å‚ç›´æ’åˆ— */
.layout-switcher.vertical {
  flex-direction: column;
  width: 60px;
  height: auto;
}

.layout-switcher.vertical .layout-button {
  width: 44px;
  margin-bottom: 4px;
}

/* ä¸‹æ‹‰èœå•æ ·å¼ */
.layout-switcher.dropdown {
  position: relative;
}

.layout-switcher.dropdown .switcher-trigger {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  cursor: pointer;
}

.layout-switcher.dropdown .switcher-menu {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  margin-top: 4px;
  background: var(--affine-background-primary-color);
  border: 1px solid var(--affine-border-color);
  border-radius: 8px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  z-index: 1000;
  opacity: 0;
  transform: translateY(-8px);
  transition: all 0.2s ease;
}

.layout-switcher.dropdown .switcher-menu.open {
  opacity: 1;
  transform: translateY(0);
}
```

#### ğŸ”§ äº¤äº’è¡Œä¸º

##### ç‚¹å‡»äº¤äº’
```typescript
class LayoutSwitcher extends LitElement {
  @state() private isTransitioning = false;
  @state() private lastClickTime = 0;
  
  private async handleModeClick(mode: PageLayoutMode, event: MouseEvent) {
    // é˜²æŠ–å¤„ç†
    const now = Date.now();
    if (now - this.lastClickTime < 300) return;
    this.lastClickTime = now;
    
    // é˜²æ­¢é‡å¤ç‚¹å‡»å½“å‰æ¨¡å¼
    if (mode === this.currentMode) return;
    
    // è®¾ç½®åŠ è½½çŠ¶æ€
    this.isTransitioning = true;
    
    try {
      // æ·»åŠ ç‚¹å‡»åé¦ˆ
      this.addClickFeedback(event.target as HTMLElement);
      
      // è§¦å‘æ¨¡å¼åˆ‡æ¢
      await this.switchToMode(mode);
      
      // è§¦å‘è§¦è§‰åé¦ˆ (ç§»åŠ¨ç«¯)
      if ('vibrate' in navigator) {
        navigator.vibrate(50);
      }
      
    } catch (error) {
      this.handleSwitchError(error);
    } finally {
      this.isTransitioning = false;
    }
  }
  
  private addClickFeedback(element: HTMLElement) {
    element.style.transform = 'scale(0.95)';
    setTimeout(() => {
      element.style.transform = '';
    }, 100);
  }
}
```

##### é”®ç›˜å¯¼èˆª
```typescript
// é”®ç›˜å¿«æ·é”®æ”¯æŒ
private handleKeydown(event: KeyboardEvent) {
  if (!this.enableKeyboardNav) return;
  
  switch (event.key) {
    case 'ArrowLeft':
      event.preventDefault();
      this.selectPreviousMode();
      break;
    case 'ArrowRight':
      event.preventDefault();
      this.selectNextMode();
      break;
    case 'Enter':
    case ' ':
      event.preventDefault();
      this.activateSelectedMode();
      break;
    case 'Escape':
      this.blur();
      break;
  }
}

// æ•°å­—é”®å¿«æ·æ–¹å¼
private handleNumberKey(event: KeyboardEvent) {
  const num = parseInt(event.key);
  if (num >= 1 && num <= 5) {
    const modes = Object.values(PageLayoutMode);
    const targetMode = modes[num - 1];
    if (targetMode) {
      this.switchToMode(targetMode);
    }
  }
}
```

##### æ‹–æ‹½æ’åº (å¯é€‰åŠŸèƒ½)
```typescript
// æ”¯æŒæ‹–æ‹½é‡æ–°æ’åˆ—å¸ƒå±€æŒ‰é’®
private setupDragAndDrop() {
  this.buttons.forEach((button, index) => {
    button.draggable = true;
    button.addEventListener('dragstart', (e) => {
      this.dragSource = index;
      e.dataTransfer?.setData('text/plain', index.toString());
    });
    
    button.addEventListener('dragover', (e) => {
      e.preventDefault();
      this.addDropIndicator(index);
    });
    
    button.addEventListener('drop', (e) => {
      e.preventDefault();
      this.reorderButtons(this.dragSource, index);
      this.removeDropIndicator();
    });
  });
}
```

### 2. ColumnContent (åˆ—å†…å®¹ç»„ä»¶)

#### ğŸ¯ è®¾è®¡ç›®æ ‡
- **å†…å®¹åŒ…å®¹**: æ”¯æŒæ‰€æœ‰ç±»å‹çš„Block
- **äº¤äº’æµç•…**: æ‹–æ‹½ã€æ·»åŠ ã€ç¼–è¾‘æ— ç¼ä½“éªŒ
- **è§†è§‰æ¸…æ™°**: æ˜ç¡®çš„åˆ—è¾¹ç•Œå’ŒçŠ¶æ€æç¤º
- **æ€§èƒ½ä¼˜ç§€**: å¤§é‡å†…å®¹æ—¶ä¿æŒæµç•…

#### ğŸ–¼ï¸ è§†è§‰è®¾è®¡

##### ç©ºåˆ—çŠ¶æ€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ç¬¬ 1 åˆ—                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚          ğŸ“„                     â”‚
â”‚     æš‚æ— å†…å®¹                     â”‚
â”‚                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚   + æ·»åŠ å†…å®¹     â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### æœ‰å†…å®¹çŠ¶æ€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ç¬¬ 2 åˆ—          [â‹®]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚        æ®µè½å—å†…å®¹             â”‚ â”‚
â”‚  â”‚  è¿™æ˜¯ä¸€æ®µç¤ºä¾‹æ–‡å­—...          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚        å›¾ç‰‡å—               â”‚ â”‚
â”‚  â”‚  [      å›¾ç‰‡é¢„è§ˆ      ]     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   + æ·»åŠ å†…å®¹                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### æ‹–æ‹½æ‚¬åœçŠ¶æ€
```
â”Œâ”€â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”‚          ç¬¬ 3 åˆ—          [â‹®]   â”‚
â”œâ”€â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚        æ®µè½å—å†…å®¹             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“ â”‚  â† æ”¾ç½®æŒ‡ç¤ºå™¨
â”‚  â”ƒ     å°†å†…å®¹æ”¾ç½®åˆ°æ­¤å¤„         â”ƒ â”‚
â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”› â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚        å›¾ç‰‡å—               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”˜
```

#### ğŸ¨ æ ·å¼è§„èŒƒ

```css
/* åˆ—å®¹å™¨ */
.column-content {
  display: flex;
  flex-direction: column;
  min-height: 200px;
  max-height: calc(100vh - 200px);
  background: var(--affine-background-primary-color);
  border: 2px solid var(--affine-border-color);
  border-radius: 12px;
  overflow: hidden;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* åˆ—å¤´éƒ¨ */
.column-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: var(--affine-background-secondary-color);
  border-bottom: 1px solid var(--affine-border-color);
  user-select: none;
}

.column-title {
  font-size: 14px;
  font-weight: 600;
  color: var(--affine-text-primary-color);
  margin: 0;
}

.column-actions {
  display: flex;
  gap: 4px;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.column-header:hover .column-actions {
  opacity: 1;
}

/* å†…å®¹åŒºåŸŸ */
.column-body {
  flex: 1;
  padding: 16px;
  overflow-y: auto;
  overflow-x: hidden;
}

.column-body::-webkit-scrollbar {
  width: 6px;
}

.column-body::-webkit-scrollbar-track {
  background: transparent;
}

.column-body::-webkit-scrollbar-thumb {
  background: var(--affine-text-disable-color);
  border-radius: 3px;
}

.column-body::-webkit-scrollbar-thumb:hover {
  background: var(--affine-text-secondary-color);
}

/* Blockå®¹å™¨ */
.block-container {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.block-item {
  position: relative;
  transition: all 0.2s ease;
}

.block-item:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.block-item.dragging {
  opacity: 0.5;
  transform: rotate(3deg);
}

/* ç©ºçŠ¶æ€ */
.column-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  flex: 1;
  padding: 32px 16px;
  color: var(--affine-text-secondary-color);
  text-align: center;
}

.empty-icon {
  font-size: 48px;
  margin-bottom: 16px;
  opacity: 0.6;
}

.empty-title {
  font-size: 16px;
  font-weight: 500;
  margin-bottom: 8px;
}

.empty-description {
  font-size: 14px;
  opacity: 0.8;
  margin-bottom: 24px;
}

/* æ·»åŠ æŒ‰é’® */
.add-content-button {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 12px 16px;
  margin: 8px 16px 16px;
  border: 2px dashed var(--affine-border-color);
  border-radius: 8px;
  background: transparent;
  color: var(--affine-text-secondary-color);
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 14px;
}

.add-content-button:hover {
  border-color: var(--affine-primary-color);
  background: var(--affine-primary-color-alpha);
  color: var(--affine-primary-color);
  transform: translateY(-1px);
}

.add-content-button:active {
  transform: translateY(0);
}

/* æ‹–æ‹½çŠ¶æ€ */
.column-content.drag-over {
  border-color: var(--affine-primary-color);
  background: var(--affine-primary-color-alpha);
  box-shadow: 0 0 0 4px var(--affine-primary-color-alpha);
}

.drop-indicator {
  height: 3px;
  background: var(--affine-primary-color);
  border-radius: 2px;
  margin: 8px 0;
  opacity: 0;
  transform: scaleX(0);
  transition: all 0.2s ease;
}

.drop-indicator.active {
  opacity: 1;
  transform: scaleX(1);
}

/* é€‰ä¸­çŠ¶æ€ */
.column-content.selected {
  border-color: var(--affine-primary-color);
  box-shadow: 0 0 0 3px var(--affine-primary-color-alpha);
}

/* åªè¯»æ¨¡å¼ */
.column-content.readonly {
  border-style: solid;
  border-color: var(--affine-border-color);
}

.column-content.readonly .add-content-button,
.column-content.readonly .column-actions {
  display: none;
}

.column-content.readonly .block-item {
  pointer-events: none;
}
```

#### ğŸ­ äº¤äº’è¡Œä¸º

##### æ‹–æ‹½åŠŸèƒ½
```typescript
class ColumnContent extends LitElement {
  private dragOverIndex = -1;
  private autoScrollTimer?: number;
  
  // å¤„ç†Blockæ‹–å…¥
  private handleDragOver(event: DragEvent) {
    event.preventDefault();
    event.dataTransfer!.dropEffect = 'move';
    
    // è®¡ç®—æ’å…¥ä½ç½®
    const insertIndex = this.calculateInsertIndex(event.clientY);
    this.updateDropIndicator(insertIndex);
    
    // è‡ªåŠ¨æ»šåŠ¨
    this.handleAutoScroll(event.clientY);
    
    // æ·»åŠ è§†è§‰åé¦ˆ
    this.classList.add('drag-over');
  }
  
  private calculateInsertIndex(clientY: number): number {
    const blocks = this.querySelectorAll('.block-item');
    const containerRect = this.getBoundingClientRect();
    const relativeY = clientY - containerRect.top;
    
    for (let i = 0; i < blocks.length; i++) {
      const blockRect = blocks[i].getBoundingClientRect();
      const blockRelativeY = blockRect.top - containerRect.top;
      const blockCenter = blockRelativeY + blockRect.height / 2;
      
      if (relativeY < blockCenter) {
        return i;
      }
    }
    
    return blocks.length;
  }
  
  private updateDropIndicator(index: number) {
    // ç§»é™¤æ—§æŒ‡ç¤ºå™¨
    this.querySelectorAll('.drop-indicator').forEach(el => el.remove());
    
    if (index === -1) return;
    
    // åˆ›å»ºæ–°æŒ‡ç¤ºå™¨
    const indicator = document.createElement('div');
    indicator.className = 'drop-indicator active';
    
    const blocks = this.querySelectorAll('.block-item');
    if (index < blocks.length) {
      blocks[index].parentNode?.insertBefore(indicator, blocks[index]);
    } else {
      this.querySelector('.block-container')?.appendChild(indicator);
    }
  }
  
  private handleAutoScroll(clientY: number) {
    const container = this.querySelector('.column-body') as HTMLElement;
    const rect = container.getBoundingClientRect();
    const scrollZone = 50; // æ»šåŠ¨è§¦å‘åŒºåŸŸ
    
    clearTimeout(this.autoScrollTimer);
    
    if (clientY < rect.top + scrollZone) {
      // å‘ä¸Šæ»šåŠ¨
      this.autoScrollTimer = window.setTimeout(() => {
        container.scrollTop -= 10;
        this.handleAutoScroll(clientY);
      }, 16);
    } else if (clientY > rect.bottom - scrollZone) {
      // å‘ä¸‹æ»šåŠ¨
      this.autoScrollTimer = window.setTimeout(() => {
        container.scrollTop += 10;
        this.handleAutoScroll(clientY);
      }, 16);
    }
  }
}
```

##### æ·»åŠ å†…å®¹äº¤äº’
```typescript
class AddContentButton extends LitElement {
  @property() columnIndex!: number;
  @property() insertIndex?: number;
  
  private handleClick(event: MouseEvent) {
    // æ˜¾ç¤ºSlashèœå•
    this.showSlashMenu(event);
    
    // æ·»åŠ ç‚¹å‡»åŠ¨ç”»
    this.addClickAnimation();
  }
  
  private showSlashMenu(event: MouseEvent) {
    const rect = this.getBoundingClientRect();
    
    // åˆ›å»ºèœå•äº‹ä»¶
    const menuEvent = new CustomEvent('show-slash-menu', {
      detail: {
        columnIndex: this.columnIndex,
        insertIndex: this.insertIndex ?? -1,
        position: {
          x: rect.left,
          y: rect.bottom + 8,
          width: rect.width
        },
        sourceElement: this
      },
      bubbles: true
    });
    
    this.dispatchEvent(menuEvent);
  }
  
  private addClickAnimation() {
    this.style.transform = 'scale(0.95)';
    this.style.transition = 'transform 0.1s ease';
    
    setTimeout(() => {
      this.style.transform = '';
      setTimeout(() => {
        this.style.transition = '';
      }, 200);
    }, 100);
  }
}
```

### 3. ColumnResizer (åˆ—å®½è°ƒæ•´å™¨)

#### ğŸ¯ è®¾è®¡ç›®æ ‡
- **ç²¾ç¡®æ§åˆ¶**: æ”¯æŒåƒç´ çº§çš„å®½åº¦è°ƒæ•´
- **è§†è§‰åé¦ˆ**: æ¸…æ™°çš„è°ƒæ•´æŒ‡ç¤ºå™¨å’Œé¢„è§ˆ
- **çº¦æŸå¤„ç†**: æœ€å°/æœ€å¤§å®½åº¦é™åˆ¶
- **è§¦æ‘¸å‹å¥½**: ç§»åŠ¨ç«¯æ‹–æ‹½ä½“éªŒä¼˜åŒ–

#### ğŸ–¼ï¸ è§†è§‰è®¾è®¡

##### é»˜è®¤çŠ¶æ€ (åˆ—ä¹‹é—´çš„åˆ†éš”çº¿)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”ƒ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”ƒ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Column 1  â”‚ â”ƒ â”‚   Column 2  â”‚ â”ƒ â”‚   Column 3  â”‚
â”‚             â”‚ â”ƒ â”‚             â”‚ â”ƒ â”‚             â”‚
â”‚   Content   â”‚ â”ƒ â”‚   Content   â”‚ â”ƒ â”‚   Content   â”‚
â”‚             â”‚ â”ƒ â”‚             â”‚ â”ƒ â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”ƒ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”ƒ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                ^                   ^
              è°ƒæ•´å™¨              è°ƒæ•´å™¨
```

##### æ‚¬åœçŠ¶æ€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â–“ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”ƒ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Column 1  â”‚ â–“ â”‚   Column 2  â”‚ â”ƒ â”‚   Column 3  â”‚
â”‚             â”‚ â–“ â”‚             â”‚ â”ƒ â”‚             â”‚
â”‚   Content   â”‚ â–“ â”‚   Content   â”‚ â”ƒ â”‚   Content   â”‚
â”‚             â”‚ â–“ â”‚             â”‚ â”ƒ â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â–“ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”ƒ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†”                   
              å…‰æ ‡å˜åŒ–
```

##### æ‹–æ‹½çŠ¶æ€ (æ˜¾ç¤ºé¢„è§ˆçº¿)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Š â–“ â”Š â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”ƒ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Column 1  â”‚ â”Š â–“ â”Š â”‚   Column 2    â”‚ â”ƒ â”‚   Column 3  â”‚
â”‚           â”‚ â”Š â–“ â”Š â”‚               â”‚ â”ƒ â”‚             â”‚
â”‚ Content   â”‚ â”Š â–“ â”Š â”‚   Content     â”‚ â”ƒ â”‚   Content   â”‚
â”‚           â”‚ â”Š â–“ â”Š â”‚               â”‚ â”ƒ â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”Š â–“ â”Š â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”ƒ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              åŸä½ç½®  æ–°ä½ç½®
              (è™šçº¿) (é«˜äº®)
```

#### ğŸ¨ æ ·å¼è§„èŒƒ

```css
/* åˆ—è°ƒæ•´å™¨å®¹å™¨ */
.column-resizer {
  position: absolute;
  top: 0;
  bottom: 0;
  width: 8px;
  margin-left: -4px;
  cursor: col-resize;
  z-index: 10;
  user-select: none;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.column-layout-container:hover .column-resizer {
  opacity: 1;
}

/* è°ƒæ•´å™¨æ‰‹æŸ„ */
.resizer-handle {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 4px;
  height: 40px;
  margin: -20px 0 0 -2px;
  background: var(--affine-primary-color);
  border-radius: 2px;
  opacity: 0;
  transition: all 0.2s ease;
}

.column-resizer:hover .resizer-handle {
  opacity: 0.6;
  width: 6px;
  margin-left: -3px;
}

.column-resizer.active .resizer-handle {
  opacity: 1;
  height: 60px;
  margin-top: -30px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

/* æ‹–æ‹½çº¿ */
.resize-guide-line {
  position: absolute;
  top: 0;
  bottom: 0;
  width: 2px;
  background: var(--affine-primary-color);
  opacity: 0;
  z-index: 1000;
  pointer-events: none;
  transition: opacity 0.1s ease;
}

.resize-guide-line.active {
  opacity: 0.8;
  box-shadow: 0 0 4px var(--affine-primary-color);
}

/* åŸä½ç½®æŒ‡ç¤ºçº¿ */
.resize-original-line {
  position: absolute;
  top: 0;
  bottom: 0;
  width: 1px;
  background: var(--affine-border-color);
  opacity: 0.5;
  z-index: 999;
  pointer-events: none;
  border-style: dashed;
}

/* å®½åº¦æç¤º */
.resize-tooltip {
  position: absolute;
  top: -32px;
  left: 50%;
  transform: translateX(-50%);
  padding: 4px 8px;
  background: var(--affine-background-overlay-panel-color);
  color: var(--affine-text-primary-color);
  border-radius: 4px;
  font-size: 12px;
  white-space: nowrap;
  opacity: 0;
  transition: opacity 0.2s ease;
  z-index: 1001;
}

.resize-tooltip.active {
  opacity: 1;
}

.resize-tooltip::after {
  content: "";
  position: absolute;
  top: 100%;
  left: 50%;
  margin-left: -4px;
  border: 4px solid transparent;
  border-top-color: var(--affine-background-overlay-panel-color);
}

/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width: 768px) {
  .column-resizer {
    width: 12px;
    margin-left: -6px;
  }
  
  .resizer-handle {
    width: 6px;
    height: 50px;
    margin: -25px 0 0 -3px;
  }
  
  .column-resizer:hover .resizer-handle {
    width: 8px;
    margin-left: -4px;
  }
}

/* è§¦æ‘¸è®¾å¤‡ä¼˜åŒ– */
@media (hover: none) {
  .column-resizer {
    opacity: 0.3;
  }
  
  .resizer-handle {
    opacity: 0.6;
    width: 6px;
  }
}
```

#### ğŸ”§ äº¤äº’è¡Œä¸º

```typescript
class ColumnResizer extends LitElement {
  @property() columnIndex!: number;
  @property() minWidth = 200;
  @property() maxWidth = 800;
  
  private isDragging = false;
  private startX = 0;
  private startWidths: number[] = [];
  private guideLine?: HTMLElement;
  private tooltip?: HTMLElement;
  
  override connectedCallback() {
    super.connectedCallback();
    this.setupEventListeners();
  }
  
  private setupEventListeners() {
    // é¼ æ ‡äº‹ä»¶
    this.addEventListener('mousedown', this.handleMouseDown);
    document.addEventListener('mousemove', this.handleMouseMove);
    document.addEventListener('mouseup', this.handleMouseUp);
    
    // è§¦æ‘¸äº‹ä»¶
    this.addEventListener('touchstart', this.handleTouchStart, { passive: false });
    document.addEventListener('touchmove', this.handleTouchMove, { passive: false });
    document.addEventListener('touchend', this.handleTouchEnd);
  }
  
  private handleMouseDown = (event: MouseEvent) => {
    if (event.button !== 0) return; // åªå¤„ç†å·¦é”®
    
    this.startDrag(event.clientX);
    event.preventDefault();
  };
  
  private handleTouchStart = (event: TouchEvent) => {
    if (event.touches.length !== 1) return;
    
    this.startDrag(event.touches[0].clientX);
    event.preventDefault();
  };
  
  private startDrag(clientX: number) {
    this.isDragging = true;
    this.startX = clientX;
    this.startWidths = this.getCurrentColumnWidths();
    
    // æ˜¾ç¤ºå¼•å¯¼çº¿å’Œæç¤º
    this.showGuideElements();
    
    // æ·»åŠ æ ·å¼ç±»
    this.classList.add('active');
    document.body.style.cursor = 'col-resize';
    document.body.style.userSelect = 'none';
    
    // è§¦å‘å¼€å§‹äº‹ä»¶
    this.dispatchEvent(new CustomEvent('resize-start', {
      detail: { columnIndex: this.columnIndex },
      bubbles: true
    }));
  }
  
  private handleMouseMove = (event: MouseEvent) => {
    if (!this.isDragging) return;
    this.updateResize(event.clientX);
  };
  
  private handleTouchMove = (event: TouchEvent) => {
    if (!this.isDragging || event.touches.length !== 1) return;
    this.updateResize(event.touches[0].clientX);
    event.preventDefault();
  };
  
  private updateResize(clientX: number) {
    const deltaX = clientX - this.startX;
    const newWidths = this.calculateNewWidths(deltaX);
    
    // åº”ç”¨çº¦æŸ
    const constrainedWidths = this.applyConstraints(newWidths);
    
    // æ›´æ–°é¢„è§ˆ
    this.updateGuideLine(constrainedWidths);
    this.updateTooltip(constrainedWidths);
    
    // å®æ—¶è°ƒæ•´ (å¯é€‰)
    if (this.enableRealTimeResize) {
      this.applyColumnWidths(constrainedWidths);
    }
  }
  
  private calculateNewWidths(deltaX: number): number[] {
    const widths = [...this.startWidths];
    const leftIndex = this.columnIndex;
    const rightIndex = this.columnIndex + 1;
    
    if (rightIndex >= widths.length) return widths;
    
    // è®¡ç®—åƒç´ å˜åŒ–å¯¹åº”çš„æ¯”ä¾‹å˜åŒ–
    const containerWidth = this.getContainerWidth();
    const deltaRatio = deltaX / containerWidth;
    
    // è°ƒæ•´ç›¸é‚»åˆ—çš„å®½åº¦
    widths[leftIndex] += deltaRatio;
    widths[rightIndex] -= deltaRatio;
    
    return widths;
  }
  
  private applyConstraints(widths: number[]): number[] {
    const constrainedWidths = [...widths];
    const containerWidth = this.getContainerWidth();
    
    for (let i = 0; i < constrainedWidths.length; i++) {
      const pixelWidth = constrainedWidths[i] * containerWidth;
      const minRatio = this.minWidth / containerWidth;
      const maxRatio = this.maxWidth / containerWidth;
      
      constrainedWidths[i] = Math.max(minRatio, Math.min(maxRatio, constrainedWidths[i]));
    }
    
    // é‡æ–°å½’ä¸€åŒ–ç¡®ä¿æ€»å’Œä¸º1
    const sum = constrainedWidths.reduce((a, b) => a + b, 0);
    return constrainedWidths.map(w => w / sum);
  }
  
  private handleMouseUp = () => {
    if (!this.isDragging) return;
    this.endDrag();
  };
  
  private handleTouchEnd = () => {
    if (!this.isDragging) return;
    this.endDrag();
  };
  
  private endDrag() {
    this.isDragging = false;
    
    // åº”ç”¨æœ€ç»ˆå®½åº¦
    const finalWidths = this.getCurrentPreviewWidths();
    this.applyColumnWidths(finalWidths);
    
    // æ¸…ç†UI
    this.hideGuideElements();
    this.classList.remove('active');
    document.body.style.cursor = '';
    document.body.style.userSelect = '';
    
    // è§¦å‘ç»“æŸäº‹ä»¶
    this.dispatchEvent(new CustomEvent('resize-end', {
      detail: {
        columnIndex: this.columnIndex,
        newWidths: finalWidths
      },
      bubbles: true
    }));
  }
  
  // åŒå‡»é‡ç½®åˆ—å®½
  private handleDoubleClick = () => {
    const columnCount = this.getColumnCount();
    const equalWidths = Array(columnCount).fill(1 / columnCount);
    
    this.applyColumnWidths(equalWidths);
    
    this.dispatchEvent(new CustomEvent('resize-reset', {
      detail: { columnIndex: this.columnIndex },
      bubbles: true
    }));
  };
}
```

### 4. LayoutToolbar (å¸ƒå±€å·¥å…·æ )

#### ğŸ¯ è®¾è®¡ç›®æ ‡
- **åŠŸèƒ½ä¸°å¯Œ**: é›†æˆå¸ƒå±€åˆ‡æ¢ã€è°ƒæ•´ã€é…ç½®ç­‰åŠŸèƒ½
- **ä¸Šä¸‹æ–‡æ•æ„Ÿ**: æ ¹æ®å½“å‰çŠ¶æ€æ˜¾ç¤ºç›¸å…³å·¥å…·
- **ç©ºé—´é«˜æ•ˆ**: ç´§å‡‘çš„è®¾è®¡ï¼Œä¸å ç”¨è¿‡å¤šç©ºé—´
- **æ‰©å±•æ€§å¼º**: æ”¯æŒæ’ä»¶æ·»åŠ è‡ªå®šä¹‰å·¥å…·

#### ğŸ–¼ï¸ è§†è§‰è®¾è®¡

##### å®Œæ•´å·¥å…·æ 
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ğŸ ] [â–Š] [â–Šâ–Š] [â–Šâ–Šâ–Š] [â–Šâ–Šâ–Šâ–Š] [â–Šâ–Šâ–Šâ–Šâ–Š] â”‚ [âš™ï¸] [â†»] [ğŸ’¾] [ğŸ“¤] [â“]    â”‚
â”‚ ä¸»é¡µ  å•åˆ—  åŒåˆ—   ä¸‰åˆ—    å››åˆ—    äº”åˆ—    è®¾ç½®  é‡ç½®  ä¿å­˜  å¯¼å‡º  å¸®åŠ©  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### ç´§å‡‘æ¨¡å¼
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â–Šâ–Šâ–Š] â”‚ [âš™ï¸] [â†»] [ğŸ’¾] â”‚ [â‹®] æ›´å¤š             â”‚
â”‚  å½“å‰    è®¾ç½®  é‡ç½®  ä¿å­˜    èœå•                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### ç§»åŠ¨ç«¯æ¨¡å¼
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â–Šâ–Šâ–Š] ä¸‰åˆ—å¸ƒå±€    [â‹®] æ›´å¤šå·¥å…·  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â”Œâ”€ å±•å¼€èœå• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ åˆ‡æ¢åˆ°å•åˆ—å¸ƒå±€              â”‚ â”‚
â”‚ â”‚ åˆ‡æ¢åˆ°åŒåˆ—å¸ƒå±€              â”‚ â”‚
â”‚ â”‚ âœ“ ä¸‰åˆ—å¸ƒå±€ (å½“å‰)          â”‚ â”‚
â”‚ â”‚ åˆ‡æ¢åˆ°å››åˆ—å¸ƒå±€              â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚ â”‚
â”‚ â”‚ é‡ç½®åˆ—å®½                   â”‚ â”‚
â”‚ â”‚ ä¿å­˜é…ç½®                   â”‚ â”‚
â”‚ â”‚ å¯¼å‡ºè®¾ç½®                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
```

#### ğŸ¨ æ ·å¼è§„èŒƒ

```css
/* å·¥å…·æ å®¹å™¨ */
.layout-toolbar {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 16px;
  background: var(--affine-background-primary-color);
  border-bottom: 1px solid var(--affine-border-color);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  position: sticky;
  top: 0;
  z-index: 100;
}

/* å·¥å…·æ åˆ†ç»„ */
.toolbar-group {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 0 8px;
}

.toolbar-group:not(:last-child)::after {
  content: "";
  width: 1px;
  height: 20px;
  background: var(--affine-border-color);
  margin-left: 8px;
}

/* å·¥å…·æŒ‰é’® */
.toolbar-button {
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 32px;
  height: 32px;
  padding: 0 8px;
  border: none;
  border-radius: 6px;
  background: transparent;
  color: var(--affine-icon-color);
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 14px;
  position: relative;
}

.toolbar-button:hover {
  background: var(--affine-hover-color);
  color: var(--affine-text-primary-color);
}

.toolbar-button:active {
  transform: scale(0.95);
}

.toolbar-button.active {
  background: var(--affine-primary-color);
  color: white;
}

.toolbar-button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

/* å·¥å…·æŒ‰é’®å›¾æ ‡ */
.toolbar-button .icon {
  width: 16px;
  height: 16px;
  margin-right: 4px;
}

.toolbar-button.icon-only .icon {
  margin-right: 0;
}

/* å·¥å…·æç¤º */
.toolbar-button[title]:hover::after {
  content: attr(title);
  position: absolute;
  top: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  padding: 6px 8px;
  background: var(--affine-background-overlay-panel-color);
  color: var(--affine-text-primary-color);
  border-radius: 4px;
  font-size: 12px;
  white-space: nowrap;
  z-index: 1000;
  opacity: 0;
  animation: fadeInTooltip 0.2s ease forwards;
}

@keyframes fadeInTooltip {
  to { opacity: 1; }
}

/* å½“å‰æ¨¡å¼æŒ‡ç¤ºå™¨ */
.current-mode-indicator {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 12px;
  background: var(--affine-background-secondary-color);
  border-radius: 6px;
  font-size: 13px;
  font-weight: 500;
  color: var(--affine-text-primary-color);
}

.mode-icon {
  font-size: 16px;
  color: var(--affine-primary-color);
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .layout-toolbar {
    padding: 6px 12px;
    gap: 8px;
  }
  
  .toolbar-button {
    min-width: 28px;
    height: 28px;
  }
  
  .toolbar-group {
    gap: 2px;
    padding: 0 4px;
  }
  
  /* éšè—ä¸€äº›ä¸é‡è¦çš„æŒ‰é’® */
  .toolbar-button.optional {
    display: none;
  }
}

/* ç´§å‡‘æ¨¡å¼ */
.layout-toolbar.compact {
  padding: 4px 8px;
  gap: 6px;
}

.layout-toolbar.compact .toolbar-button {
  min-width: 24px;
  height: 24px;
  font-size: 12px;
}

.layout-toolbar.compact .current-mode-indicator {
  padding: 4px 8px;
  font-size: 12px;
}

/* ä¸‹æ‹‰èœå• */
.toolbar-dropdown {
  position: relative;
}

.toolbar-dropdown-menu {
  position: absolute;
  top: calc(100% + 4px);
  right: 0;
  min-width: 200px;
  background: var(--affine-background-overlay-panel-color);
  border: 1px solid var(--affine-border-color);
  border-radius: 8px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  z-index: 1000;
  opacity: 0;
  transform: translateY(-8px);
  transition: all 0.2s ease;
  pointer-events: none;
}

.toolbar-dropdown-menu.open {
  opacity: 1;
  transform: translateY(0);
  pointer-events: all;
}

.dropdown-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  color: var(--affine-text-primary-color);
  cursor: pointer;
  transition: background 0.2s ease;
}

.dropdown-item:hover {
  background: var(--affine-hover-color);
}

.dropdown-item.active {
  background: var(--affine-primary-color-alpha);
  color: var(--affine-primary-color);
}

.dropdown-item:first-child {
  border-radius: 8px 8px 0 0;
}

.dropdown-item:last-child {
  border-radius: 0 0 8px 8px;
}

.dropdown-separator {
  height: 1px;
  background: var(--affine-border-color);
  margin: 4px 0;
}

/* åŠ è½½çŠ¶æ€ */
.toolbar-button.loading {
  position: relative;
  pointer-events: none;
}

.toolbar-button.loading::before {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  width: 12px;
  height: 12px;
  margin: -6px 0 0 -6px;
  border: 2px solid transparent;
  border-top: 2px solid currentColor;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

/* å¾½ç« æŒ‡ç¤ºå™¨ */
.toolbar-button .badge {
  position: absolute;
  top: -2px;
  right: -2px;
  min-width: 16px;
  height: 16px;
  padding: 0 4px;
  background: var(--affine-error-color);
  color: white;
  border-radius: 8px;
  font-size: 10px;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid var(--affine-background-primary-color);
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-07-27  
**æœ€åæ›´æ–°**: 2025-07-27  
**è®¾è®¡ç³»ç»Ÿç‰ˆæœ¬**: 1.0.0  