# 多标签 AND 逻辑搜索功能需求文档

## 📋 项目概述

**功能名称**: 多标签 AND 逻辑搜索增强  
**需求编号**: #13309  
**优先级**: 中等偏低  
**预估工时**: 3-5 个工作日  
**负责模块**: 搜索与过滤系统  

---

## 🎯 功能目标

增强 YUNKE 的搜索体验，让用户能够在主界面直接使用多标签 AND 逻辑进行文档筛选，提升内容查找效率。

### 核心价值
- **提升搜索精确度**: 支持多标签组合筛选，找到更精确的文档
- **改善用户体验**: 在主界面暴露现有的标签过滤能力
- **增强可发现性**: 让更多用户发现和使用标签功能

---

## 📊 现状分析

### ✅ 已有功能
1. **后端逻辑完整**: `TagsFilterProvider` 已实现完整的 AND/OR 逻辑
2. **集合规则系统**: 支持 `include-all` (AND)、`include-any-of` (OR) 等
3. **快速搜索**: CMDK 支持标签模糊搜索
4. **社区搜索**: 已有多标签选择界面

### ❌ 缺失功能
1. **主界面标签过滤**: 文档列表页面缺少标签筛选器
2. **可视化标签组合**: 没有直观的多标签选择界面
3. **搜索语法提示**: 用户不知道如何组合多个标签

---

## 🎨 设计方案

### 方案 A: 主界面标签过滤器 (推荐)
在文档列表页面添加标签过滤栏，支持多标签 AND 逻辑。

**优势**:
- 开发成本低，复用现有逻辑
- 用户体验直观
- 与现有 UI 风格一致

### 方案 B: 快速搜索增强
扩展 CMDK 支持 `tag:A tag:B` 语法。

**优势**:
- 符合高级用户习惯
- 不占用界面空间
- 功能强大

### 方案 C: 专门搜索页面
创建独立的高级搜索界面。

**优势**:
- 功能最完整
- 可扩展性强

**劣势**:
- 开发成本高
- 增加页面复杂度

---

## 🛠️ 技术实现

### 核心组件位置
```
packages/frontend/core/src/
├── modules/
│   ├── collection-rules/impls/filters/tags.ts    # 已有后端逻辑
│   ├── quicksearch/impls/tags.ts                 # 快速搜索标签
│   └── tag/                                      # 标签服务
├── components/
│   ├── tags/                                     # 标签组件
│   └── page-list/                                # 文档列表
└── desktop/pages/workspace/                      # 工作区页面
```

### 关键技术栈
- **前端框架**: React + TypeScript
- **状态管理**: RxJS + LiveData
- **搜索引擎**: Fuse.js (已集成)
- **UI 组件**: 现有设计系统

---

## 📐 详细设计规格

### UI/UX 规格
详见: [UI 设计规格](./ui-specifications.md)

### API 接口设计
详见: [API 设计文档](./api-design.md)

### 数据流设计
详见: [数据流图](./data-flow.md)

---

## 🚀 开发计划

### 阶段 1: 基础功能 (2 天)
- [ ] 创建标签过滤器组件
- [ ] 集成现有 TagsFilterProvider
- [ ] 实现基础 AND 逻辑

### 阶段 2: UI 优化 (1 天)
- [ ] 设计标签选择界面
- [ ] 添加搜索提示
- [ ] 响应式适配

### 阶段 3: 增强功能 (1-2 天)
- [ ] 保存搜索条件
- [ ] 快捷操作
- [ ] 性能优化

---

## ✅ 测试计划

### 单元测试
- [ ] TagsFilterProvider 逻辑测试
- [ ] 组件渲染测试
- [ ] 交互行为测试

### 集成测试
- [ ] 搜索结果准确性
- [ ] 性能测试 (大量标签/文档)
- [ ] 跨浏览器兼容性

### 用户测试
- [ ] 可用性测试
- [ ] A/B 测试 (与现有搜索对比)

---

## 📚 相关文档

- [现有搜索系统分析](./current-system-analysis.md)
- [竞品分析](./competitor-analysis.md)
- [用户研究报告](./user-research.md)
- [技术架构图](./architecture.md)

---

## 🎯 成功指标

### 技术指标
- 搜索响应时间 < 200ms
- 支持 10000+ 文档的实时过滤
- 零错误率

### 用户指标
- 标签搜索使用率提升 30%
- 用户满意度 > 4.5/5
- 搜索成功率 > 90%

---

## 📝 备注

### 风险与缓解
1. **性能风险**: 大量标签时可能影响性能
   - 缓解: 虚拟化列表、分页加载
2. **用户习惯**: 用户可能不理解 AND 逻辑
   - 缓解: 添加提示说明、默认示例

### 后续规划
- 支持标签层级结构
- 智能标签推荐
- 标签使用统计分析

---

**文档版本**: v1.0  
**创建时间**: 2025-01-25  
**最后更新**: 2025-01-25  
**维护者**: 开发团队