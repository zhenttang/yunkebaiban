# 工作空间系统功能大纲

> 状态：大纲草稿（相对 `Web端概览.md` 更细一层）。  
> 目标：从“工作空间（Workspace）”视角，把所有相关功能拆成小模块，后续每个模块都可以再继续向下扩展实现细节。

---

## 1. 工作空间总体说明

### 1.1 概念与作用

- 工作空间是用户组织内容的顶层单位：
  - 可以理解为一个“团队空间”或“项目空间”；
  - 下面包含页面（文档/白板）、数据库、集合、标签、附件等。
- 一个用户可以同时加入多个工作空间：
  - 个人空间、团队空间、自建部署空间等；
  - 支持在不同工作空间之间快速切换。

### 1.2 主要路由与入口

- `/workspace/:workspaceId/*`：工作空间主路由前缀。
- 典型入口路径：
  - 从首页 `/` 或登录后重定向；
  - 通过邀请链接 `/invite/:inviteId` 接受邀请后进入指定工作空间；
  - 通过分享链接 `/share/:workspaceId/:pageId` 重定向到工作空间内的某个页面。

### 1.3 主要前端代码位置

- 页面级：
  - `packages/frontend/core/src/desktop/pages/workspace/*`
- 列表与导航组件：
  - `packages/frontend/core/src/components/page-list/*`
  - `packages/frontend/core/src/components/workspace-selector/*`
- 属性与配置：
  - `packages/frontend/core/src/components/workspace-property-types/*`
  - `packages/frontend/core/src/components/properties/*`

---

## 2. 工作空间入口与布局模块

> 负责用户从“进入 workspace”到看到主布局（左侧导航 + 顶部栏 + 内容区）的整体体验。

### 2.1 工作空间入口逻辑

- 入口来源：
  - 用户登录后直接跳转到默认或最近使用的工作空间；
  - 用户在工作空间选择器中选择某个工作空间；
  - 用户通过邀请/分享链接被重定向到某个 workspace。
- 异常情况处理：
  - `workspaceId` 无效或用户无权限时，展示错误提示并引导回首页或其他工作空间；
  - 在网络错误或数据加载失败时显示重试和错误信息。

### 2.2 布局结构

- 左侧导航栏：
  - 显示页面树/收藏/标签/集合等导航入口；
  - 通常可折叠/展开，以适应不同屏幕宽度。
- 顶部栏：
  - 显示当前工作空间名称、当前页面标题；
  - 提供搜索入口、用户信息入口、设置入口；
  - 提供切换工作空间的入口（与 workspace-selector 组件联动）。
- 主内容区：
  - 承载具体页面内容（文档、白板、全局列表、论坛等）；
  - 支持根据不同路由渲染不同页面组件。

### 2.3 工作空间选择器（Workspace Selector）

- 功能：
  - 显示当前用户所有可访问的工作空间；
  - 显示最近使用的工作空间；
  - 提供“新建工作空间”“通过邀请加入”的入口。
- 典型交互：
  - 点击头像或当前 workspace 名称弹出列表；
  - 在列表中搜索工作空间；
  - 选择某个工作空间后跳转到该空间的默认页面。
- 主要代码位置：
  - `components/workspace-selector/*`

---

## 3. 页面与内容编辑模块

> 这一块与 BlockSuite 编辑器强相关，负责“文档 + 白板 + 数据库”等内容的编辑体验。

### 3.1 页面类型

- 普通文档页面：
  - 以块编辑器为核心，支持富文本编辑；
  - 适合写笔记、文档、会议记录等。
- 白板页面：
  - 使用画布模式（edgeless）进行自由布局绘制；
  - 用于流程图、草图、思维导图等。
- 数据库页面：
  - 以数据库块为核心，展示为表格/看板/画廊等；
  - 每一条记录可以打开为详情页或侧边栏。

### 3.2 块编辑能力（简要列举）

- 基础文本类块：
  - 段落、标题、列表、引用、Callout、代码块等。
- 富媒体类块：
  - 图片、附件、嵌入网页、嵌入其他文档等。
- 白板/图形类块：
  - 形状、连接线、流程图、drawio、excalidraw 等。
- 数据类块：
  - 数据库、数据视图（表格、看板、画廊）等。
- 高级表达：
  - Mermaid 图、LaTeX 公式等。

> 具体的 Block 类型和行为会在「Block 编辑能力」的专门文档中继续细化，这里只从工作空间功能角度列出。

### 3.3 页面级功能

- 页面属性：
  - 标题、图标、封面；
  - 标签、集合；
  - 创建时间、更新时间、作者/协作者。
- 页面操作：
  - 新建页面/子页面；
  - 复制、移动、删除（移动到回收站）；
  - 变更父级、调整排序。
- 历史与统计：
  - 查看页面历史版本；
  - 查看页面统计（浏览量/编辑次数等，视实现而定）。

---

## 4. 页面组织与导航模块

> 这一块由「页面树 + 全局列表」等组成，负责“在哪里找到我想要的页面”。

### 4.1 页面树（侧边栏）

- 展示内容：
  - 当前工作空间内的所有页面，按层级组织；
  - 可能区分不同类型（文档、数据库、白板等）显示不同图标。
- 交互能力：
  - 点击节点打开对应页面；
  - 拖拽改变顺序和层级；
  - 右键或菜单进行：重命名、移动、删除、收藏等操作。
- 辅助能力：
  - 快速搜索：在侧边栏内缩小范围查找页面；
  - 折叠/展开：控制树的层级展示。

### 4.2 收藏与常用区

- 收藏功能：
  - 将常用页面加入收藏；
  - 收藏项在侧边栏顶部或独立区域展示。
- 置顶/快捷访问：
  - 可以将某些页面置顶，以便更快访问；
  - 可能提供“最近打开”等动态列表。

### 4.3 标签与集合导航

- 标签导航：
  - 在侧边栏或单独页面列出所有标签；
  - 点击标签即可查看带有该标签的页面列表。
- 集合导航：
  - 集合将相关页面按主题分组；
  - 在集合视图中快速浏览和管理该集合下的所有页面。

---

## 5. 全局视图与列表模块

> 主要由 `all-page`、`all-tag`、`all-collection` 等页面组成，用于“从全局角度管理内容”。

### 5.1 全部页面视图（All Pages）

- 功能：
  - 查看当前工作空间内所有页面（不按层级，仅按列表形式显示）；
  - 支持搜索、排序、筛选。
- 常见筛选条件：
  - 创建者、最后编辑者；
  - 标签、集合；
  - 页面类型（文档/数据库/白板等）；
  - 创建时间/更新时间范围。
- 常见排序方式：
  - 按更新时间、创建时间、标题、浏览量等。

### 5.2 标签视图（All Tags）

- 展示：
  - 当前工作空间下所有已使用的标签；
  - 每个标签显示绑定页面数量。
- 交互：
  - 点击某标签，进入“按标签过滤的页面列表”；
  - 在标签视图中创建/重命名/删除标签。

### 5.3 集合视图（All Collections）

- 展示：
  - 所有集合及其描述、成员页面数；
  - 区分系统集合与用户自定义集合。
- 交互：
  - 新建集合、编辑集合名称与描述；
  - 管理集合内的页面（添加/移除）。

---

## 6. 附件与资源管理模块

### 6.1 附件列表页

- 功能：
  - 汇总展示工作空间内所有附件资源；
  - 支持按类型（图片、音视频、PDF、Office 文档等）过滤；
  - 支持按上传时间/大小排序。

### 6.2 附件预览与跳转

- 预览能力：
  - 图片预览（缩略图+原图）；
  - PDF 内嵌阅读；
  - 音频、视频播放；
  - 文本附件查看。
- 跳转能力：
  - 一键打开包含该附件的页面；
  - 显示附件所属页面/块的信息。

### 6.3 附件操作

- 基本操作：
  - 下载、重命名、删除；
  - 复制链接（若系统允许外链访问）。
- 权限控制：
  - 删除/重命名仅对有权限的用户开放；
  - 受工作空间整体权限和具体页面权限共同约束。

---

## 7. 分享与访问控制模块

### 7.1 页面分享

- 生成分享链接：
  - 从页面内点击“分享”按钮；
  - 弹出分享设置面板，配置访问级别和过期时间等。
- 分享链接参数：
  - 与后端配合实现不同访问级别：
    - 公开访问（持有链接即可查看）；
    - 登录后访问；
    - 限定工作空间成员；
    - 限定特定受邀人员。

### 7.2 分享访问流程

- 入口：
  - 用户打开 `/share/:workspaceId/:pageId`；
  - 前端根据路由参数重定向到对应工作空间和页面。
- 异常处理：
  - 分享链接已过期 → 跳转到 `/expired` 并给出提示；
  - 用户无权限 → 提示错误并引导登录/联系管理员。

### 7.3 协同编辑与在线状态

- 协同编辑：
  - 多人同时在一个页面内编辑时，展示其他用户的光标/选区；
  - 冲突由底层同步/合并逻辑处理。
- 在线状态：
  - 在页面或工作空间顶部显示当前在线成员头像；
  - 可用于快速发起协作（如评论、@人等）。

---

## 8. 工作空间设置与成员管理模块

### 8.1 基础设置

- 可配置内容：
  - 工作空间名称、图标、封面；
  - 默认首页（如某个页面或某个视图）；
  - 默认语言、时区等。

### 8.2 成员与角色

- 成员列表：
  - 展示所有成员及其角色（所有者/管理员/成员/访客等）；
  - 显示加入时间、最近活跃时间等信息（视实现而定）。
- 邀请成员：
  - 通过邮件邀请；
  - 生成邀请链接（配合 `/invite/:inviteId`）。
- 角色与权限：
  - 为不同角色设置不同权限级别（查看/编辑/管理等）；
  - 部分高级操作仅对所有者/管理员开放。

### 8.3 高级设置与配额

- 存储配额：
  - 显示当前工作空间的存储使用情况；
  - 在接近或超过配额时提示 over-capacity，限制某些操作（如上传大附件）。
- 云同步与备份：
  - 控制是否启用云同步；
  - 查看备份策略/状态（详细实现放在存储相关文档中）。

---

## 9. 与其他模块的关系（简要）

### 9.1 与论坛模块的关系

- 论坛（`/forum/*`）通常挂载在某个工作空间下：
  - 将论坛视为工作空间内的一个“社区子系统”；
  - 与工作空间成员体系共享用户与权限。

### 9.2 与模板/剪藏模块的关系

- 模板导入与剪藏导入都需要落地到具体工作空间：
  - 导入模板 → 在该工作空间中创建新的页面或数据库；
  - 剪藏导入 → 将内容插入到指定工作空间的某个页面或新建页面。

### 9.3 与 AI 与存储模块的关系

- AI 能力：
  - 在工作空间内调用 AI（生成内容、整理、翻译等），AI 生成结果直接写入当前页面；
  - 工作空间配置可能影响可用的 AI 模型或额度（由 Admin 端控制）。
- 存储与同步：
  - 工作空间中的所有数据（页面、附件等）通过 nbstore + Worker + 云存储进行管理；
  - 前端在工作空间级别感知同步状态（例如云存储状态提示）。

---

> 后续扩展建议：  
> - 对本文件中的每个大章节（例如“页面与内容编辑”“页面组织与导航”）再拆出单独文档，详细说明具体 UI、交互流程和关键实现细节；  
> - 补充“典型用户操作流程”（例如“新建工作空间→创建文档→添加成员→分享页面”）；  
> - 在实现文档中，对应到具体的 React 组件、hooks 和后端接口。

