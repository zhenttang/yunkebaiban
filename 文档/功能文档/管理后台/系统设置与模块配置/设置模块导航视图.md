# 设置模块导航视图（功能 + 实现说明）

> 关联上级：`管理后台/系统设置与模块配置.md`  
> 相关代码位置：
> - 导航组件：`packages/frontend/admin/src/modules/settings/index.tsx`（`SettingsSidebar`）
> - 配置模块列表：`packages/frontend/admin/src/modules/settings/config.ts`

---

## 1. 模块列表数据来源

### 1.1 ALL_SETTING_GROUPS 映射

- 左侧导航展示的模块列表，来自 `ALL_SETTING_GROUPS`：

```ts
export const ALL_SETTING_GROUPS = [
  ...KNOWN_CONFIG_GROUPS,
  ...UNKNOWN_CONFIG_GROUPS,
];
```

- 在 `SettingsSidebar` 中，会遍历该数组渲染每一个模块条目：

```tsx
<nav className="mt-4 flex-1 space-y-1 px-2 pb-6">
  {ALL_SETTING_GROUPS.map(group => {
    const isActive = group.module === currentModule;
    const isDirty = dirtyModules[group.module];
    return (
      <button
        key={group.module}
        type="button"
        onClick={() => onNavigate(group.module)}
        className={/* 根据 isActive 设置样式 */}
      >
        <div className="flex items-center justify-between gap-2">
          <span className="font-medium">{group.name}</span>
          {isDirty ? <Badge variant="outline">待保存</Badge> : null}
        </div>
        <p className="text-xs text-slate-400">/{group.module}</p>
      </button>
    );
  })}
</nav>
```

- 展示信息包括：
  - 模块中文名称 `group.name`（如“服务器”、“存储服务”、“认证授权”等）；
  - 模块路径 `/{group.module}`，用于辅助理解配置划分；
  - 若模块存在未保存修改，则在右侧显示“待保存”徽标。

### 1.2 已知模块与动态模块的一致展示

- 无论模块来自 `KNOWN_CONFIG_GROUPS` 还是 `UNKNOWN_CONFIG_GROUPS`：
  - 只要出现在 `ALL_SETTING_GROUPS` 中，就会在导航中渲染；
  - 导航项的行为完全一致；
  - 区别仅在于配置字段与说明是否更精细（已知模块通常拥有更细致的字段描述和快捷操作）。

---

## 2. 当前模块高亮与路由同步

### 2.1 currentModule 与 URL 的关系

- 当前选中的模块由两处状态共同决定：
  - URL 中的 `:module` 参数（`/admin/settings/:module`）；
  - `useNav` 上下文中的 `currentModule`。

- 在 `SettingsPage` 顶部的 `useEffect` 中：
  - 若 URL 中存在 `module`，则调用 `setCurrentModule(module)`，同步上下文；
  - 若不存在 `module`，则导航到第一个可用模块，并设置 `currentModule`。

### 2.2 点击导航时的行为

- `SettingsSidebar` 接受一个 `onNavigate` 回调：

```tsx
const handleNavigateModule = useCallback(
  (target: string) => {
    navigate(`/admin/settings/${target}`);
    setCurrentModule(target);
  },
  [navigate, setCurrentModule]
);
```

- 当用户点击某个模块条目时：
  - 更新路由到对应模块；
  - 同步上下文中的 `currentModule`；
  - 触发 `SettingsPage` 重新计算当前分组 `currentGroup`；
  - `AdminPanel` 切换到该模块的配置字段。

### 2.3 高亮当前模块的样式

- 通过 `isActive = group.module === currentModule` 控制导航项样式：
  - 当前模块使用主色背景（如 `bg-primary/10`）、更深文字颜色，并加轻微阴影；
  - 非当前模块使用灰色文字，并在 hover 时改变背景与文字颜色。

> 这种设计保证了：管理员始终可以清楚地知道自己当前正在配置哪个模块，同时通过 URL 直接分享或收藏某个具体设置模块的链接。

---

## 3. “待保存”标记与用户感知

### 3.1 模块级“待保存”标记

- `SettingsSidebar` 通过传入的 `dirtyModules`，在模块级别展示“待保存”徽标：
  - `dirtyModules[group.module]` 表示该模块中被修改但未保存的字段数量；
  - 只要该值存在且大于 0，就在模块右侧显示一个小的 `Badge`，文案为“待保存”。

- 好处：
  - 当管理员在多个模块之间来回跳转时，不会忘记哪些模块还没保存；
  - 在最终点击“保存更改”前，可以逐个回到这些模块进行检查。

### 3.2 与顶部全局“待保存”数量的配合

- 顶部 `Header` 会显示全局的 `pendingCount`（所有模块合计的待保存项数量）；
- 左侧导航中的“待保存”徽标则显示“哪些模块受影响”；
- 二者配合：
  - 全局层面：告诉你“还有多少项配置尚未保存”；
  - 模块层面：告诉你“这些未保存的修改分别位于哪些模块”。

> 通过这种导航视图的设计，系统设置模块既能支持大量配置项，又能在交互上保持清晰的结构和状态反馈，适合作为整个系统的统一配置入口。

