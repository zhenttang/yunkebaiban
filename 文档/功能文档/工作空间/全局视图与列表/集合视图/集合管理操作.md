# 集合管理操作（功能 + 实现说明）

> 关联上级：`工作空间/全局视图与列表/集合视图.md`  
> 相关代码位置：
> - 集合视图和操作栏：`packages/frontend/core/src/components/page-list/view/*`（`collection-operations.tsx` 等）
> - 集合列表渲染：`page-group.tsx` 中 `CollectionListItemRenderer`
> - 集合模块：`modules/collection/*`

---

## 1. 集合创建与编辑

### 1.1 创建新集合

- 在“集合视图”或相关页面顶部，有一个“新建集合”按钮（对应 `create-collection` 相关组件）：
  - 点击后弹出集合创建对话框；
  - 表单内容包括：
    - 集合名称（必填）；
    - 描述（可选）；
    - 可选的图标或颜色（视产品设计）。

行为流程：

1. 用户填写信息并点击“创建”；
2. 前端校验必填项与格式；
3. 调用 `Collection` 模块相关 API 新建集合；
4. 将新集合插入集合列表并选中/跳转到该集合视图。

### 1.2 编辑集合名称与描述

- 在集合列表或集合详情视图中：
  - 提供“编辑集合”入口（例如在集合操作栏中）；
  - 触发同一表单界面，预填现有名称与描述；
  - 保存后更新后端并刷新本地状态。

`useActions` 中的编辑操作示例（用于集合操作栏）：

```tsx
const t = useI18n();
return [
  {
    icon: <FilterIcon />,
    name: 'edit',
    tooltip: t['com.yunke.collection-bar.action.tooltip.edit'](),
    click: () => {
      openEdit(collection);
    },
  },
  // ...
];
```

> 这里的 `openEdit(collection)` 一般会打开集合编辑对话框。

### 1.3 删除集合

- 集合操作栏中也有“删除”按钮：

```tsx
{
  icon: <DeleteIcon style={{ color: 'var(--yunke-error-color)' }} />,
  name: 'delete',
  tooltip: t['com.yunke.collection-bar.action.tooltip.delete'](),
  click: onDelete,
}
```

- 删除流程：
  - 点击删除时弹出确认对话框（避免误删）；
  - 确认后调用删除 API；
  - 从集合列表中移除该集合；
  - 通常不会删除集合下的页面，只是“取消归类”（视产品设计）。

---

## 2. 集合内容管理

### 2.1 向集合中添加页面

添加页面到集合的方式通常有三种：

1. 在页面属性面板中选择集合：
   - 页面属性中提供“所属集合”字段；
   - 用户选择一个或多个集合；
   - 保存后，该页面出现在对应集合下。

2. 在集合视图中通过操作将页面加入集合：
   - 在 All Pages 视图中选择某些页面；
   - 使用“保存为集合”或“添加到集合”按钮；
   - 选择目标集合后批量加入。

3. 拖拽：
   - 在页面列表中，将页面条目拖到集合节点上；
   - Drop 事件中调用“添加到集合”的 API。

### 2.2 从集合中移除页面

- 在集合详情视图中：
  - 对某条页面记录提供“从集合移除”操作；
  - 或在多选模式中批量移除选中的页面；
  - 执行后，该页面仍然存在于工作空间，只是不再属于此集合。

### 2.3 调整集合内页面顺序（如支持）

- 在集合视图中，可以支持对集合内页面进行排序：
  - 按更新时间/创建时间排序（通过排序控件实现）；
  - 手动拖拽调整顺序（如果集合支持“自定义顺序”）。

实现方式：

- 利用 `page-list` 的排序机制（`ListTableHeader` + `sorterAtom`）进行基于字段的排序；
- 如果需要“自定义顺序”，则在后端存储一个集合内部的顺序信息，并在拖拽时更新该顺序。

---

## 3. 权限与交互限制

- 集合管理操作也需要权限控制：
  - 只有具备特定权限（如“集合管理”或“workspace 编辑”）的用户才能创建/删除集合；
  - 普通成员可能只能将页面加入/移除集合，而不能删除集合本身。
- 前端应结合 `useGuard`（类似文档和工作空间权限）控制：
  - 是否显示“新建集合”“删除集合”按钮；
  - 是否允许在集合视图中进行拖拽和批量操作。

> 集合提供了一种在“标签之外”的结构化组织方式，与标签视图相互补充：集合更像是“人工设定的专栏/项目组”，而标签更适合同一页面拥有多个不同维度的标注。 
