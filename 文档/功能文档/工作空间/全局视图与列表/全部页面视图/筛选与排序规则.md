# 筛选与排序规则（功能 + 实现说明）

> 关联上级：`工作空间/全局视图与列表/全部页面视图.md`  
> 相关代码位置：
> - 页面列表基础设施：`packages/frontend/core/src/components/page-list/*`
> - 列表表头与排序：`page-header.tsx`（`ListTableHeader`）
> - 通用过滤组件：`components/filter/*`

---

## 1. 筛选条件

### 1.1 标签与集合筛选

- 在“全部页面视图”中，常见的筛选需求包括：
  - 按标签筛选：只显示包含某个/某几个标签的页面；
  - 按集合筛选：只显示属于某个集合的页面。
- 实现思路：
  - 使用统一的 Filter 组件体系（`components/filter/*`）构建条件：

```tsx
export const Filter = ({
  filter,
  isDraft,
  onDraftCompleted,
  onDelete,
  onChange,
}: {
  filter: FilterParams;
  // ...
}) => {
  const type = filter.type;

  const Condition =
    type === 'property'
      ? PropertyFilterCondition
      : type === 'system'
        ? SystemFilterCondition
        : null;

  // ...
};
```

- 对标签/集合筛选：
  - 通过“系统条件”（system）或“属性条件”（property）指定筛选字段为 `tags` 或 `collection`；
  - 在 Condition 内使用选择器组件让用户选择需要的标签/集合。

### 1.2 创建者/编辑者筛选

- 功能：
  - 按“创建者”筛选页面；
  - 按“最近编辑者”筛选页面。
- 实现思路：
  - 在 Filter 条件中，将字段设置为 `createdBy` 或 `lastModifiedBy`；
  - 使用成员选择器（结合 `WorkspaceMembersService`）让用户选择目标成员；
  - 列表查询时将这些条件传递给后端或本地过滤逻辑。

### 1.3 时间区间筛选

- 创建时间/更新时间区间：
  - 允许选择起始时间和结束时间；
  - 只显示在该区间内创建/更新的页面。
- 实现思路：
  - Filter 条件类型为 `system`；
  - 字段为 `createdAt` 或 `updatedAt`；
  - 使用日期区间选择组件接受用户输入；
  - 过滤时使用“>= 起始时间 && <= 结束时间”的条件。

---

## 2. 排序规则

### 2.1 排序字段

在“全部页面视图”中，常见排序字段包括：

- 更新时间（默认）；
- 创建时间；
- 标题（字母顺序）；
- 其他如：收藏状态、访问量（如有）等。

### 2.2 列表表头与排序交互

- 排序逻辑集中在 `ListTableHeader` 组件中（`page-header.tsx`）：

```tsx
export const ListTableHeader = memo(function ListTableHeader({
  headerCols,
}: {
  headerCols: HeaderColDef[];
}) {
  const [sorter, setSorter] = useAtom(sorterAtom);
  const onSort = useCallback(
    (sortable?: boolean, sortKey?: keyof ListItem) => {
      if (sortable && sortKey) {
        setSorter({
          newSortKey: sortKey,
        });
      }
    },
    [setSorter]
  );

  // 渲染每一个表头单元格 ListHeaderCell，点击时调用 onSort
});
```

- 行为说明：
  - 表头中每一列可以声明 `sortable: true/false` 和对应的 `key`；
  - 用户点击可排序的表头时，调用 `setSorter` 更新排序字段和顺序；
  - 列表内部使用 `sorterAtom` 提供的当前排序状态对数据进行排序。

### 2.3 排序顺序与 UI 提示

- 每次点击排序列：
  - 第一点击：按该字段升序；
  - 第二点击：按该字段降序；
  - 第三点击：可选回到默认排序（视实现）。
- UI 显示：
  - 当前排序列会显示排序箭头；
  - 结合 `sorter.key` 和 `sorter.order` 决定图标方向。

---

## 3. 筛选与排序的结合

- 在实际使用中，筛选与排序通常会同时生效：
  - 先应用所有筛选条件缩小数据集；
  - 再按照排序字段对结果集排序。
- 例如：
  - 只看“标签 A”的页面；
  - 在此基础上按“更新时间从近到远”排序。

实现建议：

- 保持筛选状态和排序状态在全局或页面级别的 store 中（例如 `listPropsAtom` + `sorterAtom`）；
- 在路由或 URL 查询参数中编码这些状态，支持在刷新/分享链接时保持视图不变（视需求）。 
