# 基础属性编辑（功能 + 实现说明）

> 关联上级：`工作空间/页面与内容编辑/页面属性与元数据.md`  
> 主要代码位置：
> - 页面头部：`packages/frontend/core/src/desktop/pages/workspace/detail-page/detail-page-header.tsx`
> - 文档显示元信息：`DocDisplayMetaService`（标题等）
> - 页面属性/封面组件：`packages/frontend/core/src/components/properties/*`（后续可以单独开文档）

---

## 1. 标题编辑

### 1.1 功能说明

- 用户可以直接在页面顶部编辑标题：
  - 普通页面：在文档头部的标题区域内点击并输入文本；
  - 日志/特殊页面：标题可能由日期等规则生成，但仍通过同一服务读取。
- 标题修改需要：
  - 实时更新当前页面的显示标题；
  - 同步更新左侧页面树、全局列表等使用标题的地方；
  - 支持撤销/重做（依赖底层数据层）。

### 1.2 前端实现概览

- 标题展示与编辑主要由两部分组成：
  - `ViewTitle`：负责在头部展示当前页面标题（只读视图）；
  - `BlocksuiteHeaderTitle`：负责真正的可编辑输入（inline edit）。
- 在普通页面头部组件 `NormalPageHeader` 中：
  - 使用 `DocDisplayMetaService` 提供的 `title$` 流获取当前页面标题；
  - 使用 `BlocksuiteHeaderTitle` 提供“点击进入编辑模式”的内联编辑能力；
  - 通过 `InlineEditHandle` 的 `triggerEdit` 方法，可以从菜单中触发重命名操作。

#### 1.2.1 标题数据来源

- 代码示例（简化版）：

```ts
const docDisplayMetaService = useService(DocDisplayMetaService);
const i18n = useI18n();
const title = i18n.t(useLiveData(docDisplayMetaService.title$(page.id)));
```

- 说明：
  - `DocDisplayMetaService.title$(page.id)` 返回当前文档标题的响应式流；
  - `useLiveData` 订阅这一流，当标题变化时自动重新渲染；
  - `i18n.t` 用于处理多语言/占位符等情况。

#### 1.2.2 标题编辑组件

- 代码位置：`detail-page-header.tsx` 中的 `BlocksuiteHeaderTitle`：

```tsx
const titleInputHandleRef = useRef<InlineEditHandle>(null);

const onRename = useCallback(() => {
  setTimeout(
    () => titleInputHandleRef.current?.triggerEdit(),
    500 /* 等待菜单动画结束 */
  );
}, []);

// ...
<BlocksuiteHeaderTitle inputHandleRef={titleInputHandleRef} />
```

- 行为说明：
  - `BlocksuiteHeaderTitle` 内部渲染一个可点击的标题区域；
  - 正常情况下，用户点击标题会进入编辑模式；
  - 从菜单中选择“重命名”时，通过 `triggerEdit()` 主动触发编辑；
  - 编辑完成后，标题变更会写入底层 Store/服务（由组件内部调用服务完成）。

### 1.3 交互细节

- 编辑开始：
  - 点击标题区域或调用 `triggerEdit`；
  - 标题变成可编辑输入框，自动聚焦。
- 编辑结束：
  - 回车确认保存；
  - 失焦时也会尝试保存；
  - 空标题时通常回退为“Untitled”或类似占位（由服务约定）。
- 同步更新：
  - 标题更新后，使用同一服务的其他订阅方（侧边栏、全局列表）会自动更新显示。

---

## 2. 图标（Icon）编辑

> 图标编辑相关组件集中在 `packages/frontend/core/src/components/properties` 与 `workspace-property-types` 中，本节只从工作空间功能角度说明。

### 2.1 功能说明

- 每个页面可以设置一个图标，用于在：
  - 页面头部标题旁显示；
  - 左侧页面树、全局列表等位置显示；
  - 作为视觉识别和分类辅助。
- 图标支持多种形式（视实现）：
  - Emoji；
  - 内置图标；
  - 自定义图片（链接或上传）。

### 2.2 前端实现概览

- 页面图标通常由一个属性组件负责：
  - 提供一个触发按钮（点击后弹出图标选择面板）；
  - 图标选择面板中包含：
    - 常用/最近使用的图标；
    - Emoji 选择器；
    - 自定义上传入口（如支持）。
- 图标作为页面属性的一部分存储：
  - 通过属性服务或 Doc 元信息服务读写；
  - 与标题类似，更新后会在相关视图中自动刷新。

### 2.3 典型交互流程

1. 用户将鼠标移到页面标题左侧的图标区域；
2. 点击图标（或占位图标）打开选择面板；
3. 在面板中选择一个 Emoji 或上传图片；
4. 前端调用属性更新接口，将新图标写入当前页面的属性；
5. 页面头部、侧边栏、全局列表中的图标同步更新。

---

## 3. 封面（Cover）编辑

### 3.1 功能说明

- 封面用于在文档顶部展示一块横幅式图片，增强视觉效果；
- 用户可以：
  - 选择系统提供的内置封面；
  - 上传自定义图片作为封面；
  - 删除封面（恢复为无封面状态）。

### 3.2 前端实现概览

- 封面通常由“页面属性面板”或头部区域中的“更换封面”入口控制；
- 封面信息作为页面的元数据之一存储：
  - 包含封面类型（内置/自定义）、图片 URL 等字段；
  - 更新时通过属性服务统一写入。

### 3.3 典型交互流程

1. 用户点击“添加封面”或“更换封面”按钮；
2. 弹出封面选择面板：
   - 展示若干内置封面；
   - 提供“上传图片”按钮；
3. 用户选择或上传图片后：
   - 前端将图片地址写入当前页面的封面属性；
   - 头部区域重新渲染，显示新封面；
4. 用户点击“移除封面”：
   - 前端清空封面相关属性；
   - 页面恢复为无封面状态。

---

## 4. 与其他模块的关系

- 标题与封面作为“页面显示元信息”，由 `DocDisplayMetaService` 等服务统一管理：
  - 确保在不同视图（头部、侧边栏、全局列表、历史版本等）中保持一致；
  - 便于后续扩展更多展示属性（如小标签、标记等）。
- 图标和封面同时也与“收藏”“分享”“论坛分享”等功能产生联动：
  - 收藏列表中会展示页面图标和标题；
  - 分享到社区（论坛）时，可复用页面封面作为展示图（视最终实现）。

> 后续可以在「页面属性组件实现」相关文档中，进一步对图标选择组件、封面选择组件、属性服务接口进行更细的技术说明（包括参数、数据结构、错误处理等）。

