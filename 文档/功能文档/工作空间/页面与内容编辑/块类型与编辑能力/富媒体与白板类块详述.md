# 富媒体与白板类块详述（功能 + 实现说明）

> 关联上级：`工作空间/页面与内容编辑/块类型与编辑能力.md`  
> 主要块定义位置：
> - `blocksuite/yunke/blocks/image/*`
> - `blocksuite/yunke/blocks/attachment/*`
> - `blocksuite/yunke/blocks/embed/*`、`embed-doc/*`、`bookmark/*`
> - `blocksuite/yunke/blocks/surface/*`、`surface-ref/*`、`edgeless-text/*`
> - `blocksuite/yunke/blocks/flowchart/*`、`drawio/*`、`excalidraw/*` 等  
> 富媒体预览与扩展：
> - `packages/frontend/core/src/blocksuite/attachment-viewer/*`
> - `packages/frontend/core/src/blocksuite/view-extensions/*`

---

## 1. 富媒体类块

### 1.1 图片块（Image）

- 功能：
  - 在文档或白板中插入图片；
  - 支持缩放、对齐、标题说明等基本操作；
  - 支持通过拖拽上传、粘贴或从剪贴板导入。
- 实现概览：
  - BlockSuite 中定义 image 块 schema（包含 URL、宽高、标题等字段）；
  - 前端通过工具栏/插入菜单触发创建 image 块；
  - 上传完成后将返回的图片地址写入块属性。

### 1.2 附件块（Attachment）

- 功能：
  - 在文档中插入任意类型文件（PDF、音视频、Office 文档等）；
  - 显示文件名、大小、类型图标；
  - 提供下载、预览或“在新标签页打开”等操作。
- 实现概览：
  - 块中存储附件元信息（文件名、大小、MIME、存储Key等）；
  - `attachment-viewer` 负责根据类型选择合适的预览方式：
    - `audio/*`：音频播放器；
    - `pdf/*`：内嵌 PDF 浏览器；
    - 文本：文本预览；
    - 其他：下载或跳转。

### 1.3 嵌入网页/文档块（Embed / Embed-Doc / Bookmark）

- 嵌入网页（Embed）：
  - 根据 URL 渲染嵌入内容（如 iframe 或卡片视图）；
  - 支持显示网页标题、图标、描述等。
- 嵌入文档（Embed-Doc）：
  - 在当前页面中嵌入另一个文档的视图或链接；
  - 可以与引用系统（reference-link）协作。
- 书签块（Bookmark）：
  - 用卡片形式展示外部链接；
  - 显示标题、摘要、封面图等。

实现要点（概览）：

- 通过 `reference-renderer` 和相关 view-extension 将引用/嵌入渲染为 React 组件；
- 使用 `YunkePageReference` / `YunkeSharedPageReference` 渲染内部文档引用；
- 对外部链接可结合预取服务获取网站元数据（视实现）。

### 1.4 音频与视频块（通过附件或专用块）

- 音频块：
  - 可直接在文档中播放音频；
  - 与 `patchForAudioEmbedView` 集成，为音频提供专门 UI。
- 视频块：
  - 视实现可能通过附件或专用 embed 类型支持；
  - 提供播放/暂停/进度控制等。

---

## 2. 白板类块与 Edgeless 模式

### 2.1 Surface / Edgeless 文本块

- Surface 块：
  - 作为白板画布的容器；
  - 支持在其内部放置各种形状、文本、连接线等对象。
- Edgeless 文本块（edgeless-text）：
  - 在无边界画布上放置文本节点；
  - 支持拖拽移动、缩放、旋转等。

功能特性：

- 画布可以无限缩放和平移；
- 节点之间通过连线表示关系；
- 可组合多种块类型构建复杂图形。

### 2.2 流程图 / Drawio / Excalidraw 块

- 流程图块（flowchart）：
  - 用于绘制流程图、状态机等结构；
  - 支持常见节点形状及连接线样式。
- Drawio 块：
  - 与 draw.io 风格的图形编辑集成；
  - 支持导入/导出特定格式（视实现）。
- Excalidraw 块：
  - 集成近似手绘风格的 Excalidraw；
  - 适用于快速草图与白板协作。

实现概览：

- 各图形块在 BlockSuite 层定义 schema 与渲染器；
*- 编辑器在 edgeless 模式下启用这些块，并提供相应工具栏（图形、连线等工具）。

### 2.3 形状与连接线块

- 形状块：
  - 矩形、圆形、菱形等基本形状；
  - 可调整大小、颜色、边框样式。
- 连接线块：
  - 连接两个节点；
  - 支持直线、折线、曲线；
  - 端点附着在节点上，随节点移动而自动更新位置。

---

## 3. Edgeless 模式下的特殊行为

### 3.1 画布交互

- 平移：
  - 按住空白区域拖拽；
  - 或使用中键/触控板手势。
- 缩放：
  - 使用鼠标滚轮 + 修饰键；
  - 使用专门的缩放控制组件（视实现）。
- 多选与框选：
  - 在画布上拖动选择多个对象；
  - 对选中对象进行统一操作（移动、删除、对齐等）。

### 3.2 与文档模式的切换

- 通过 `EditorModeSwitch` 在文档模式与 edgeless 模式之间切换：
  - 文档模式：以线性文本/块文档为主；
  - Edgeless 模式：以画布和白板块为主；
- 切换时：
  - 重用同一 `pageId` 的底层数据结构；
  - 调整视图和 UI（工具栏、头部图标等）。

### 3.3 与 AI/协作的结合（概览）

- 白板上的 AI：
  - 通过 Copilot 生成图形结构或自动布局（详见 AI 文档）；
- 协作：
  - 画布中的节点和连线也参与实时协作；
  - 显示其他用户的选中节点或操作行为（视实现）。

---

## 4. 与附件列表和预览模块的关系

- 附件块与“附件列表视图”紧密关联：
  - 每个附件块对应一个附件记录；
  - 在 `附件列表视图` 中对这些记录进行汇总展示；
  - 从列表中点击可跳转回对应页面和块位置（视实现）。
- 富媒体预览由 `attachment-viewer` 系列组件统一处理：
  - 保证在列表视图和页面内预览体验一致；
  - 方便统一管理文件类型支持和限制（如大小限制、格式限制等）。

> 后续可以在“附件与资源管理”与“白板与 AI”相关文档中，对具体的 Block 数据结构、扩展点接口进行更详细的技术说明。 
