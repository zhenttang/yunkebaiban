# 最近访问列表逻辑（功能 + 实现说明）

> 关联上级：`工作空间/页面组织与导航/收藏与最近访问.md`  
> 相关代码位置：
> - 最近使用工作空间 ID 存储：`workspace/index.tsx` 中 `localStorage.setItem('last_workspace_id', ...)`
> - 页面级“最近访问”可通过类似机制在前端实现，或由后端统一记录（当前代码中未完全展开，以下为设计说明）。

---

## 1. 最近访问的记录规则（设计）

### 1.1 触发时机

- 当用户成功打开某个页面时（即完成路由跳转且文档加载成功）：
  - 记录一次“最近访问页面”的事件；
  - 更新最近访问列表（无论是在本地还是在服务端）。

### 1.2 记录内容

每条“最近访问”记录通常包含：

- `pageId`：页面 ID；
- `workspaceId`：所属工作空间；
- `title`：页面标题（用于展示）；
- `icon`：页面图标（用于展示）；
- `visitedAt`：最近访问时间戳。

### 1.3 条数限制

- 为避免无限增长，应限制记录条数，例如：
  - 仅保留最近 20~50 条；
  - 当新记录加入时，移除最早访问的记录；
  - 对于同一页面，更新时间而不是重复插入。

---

## 2. 最近访问列表的展示与交互

### 2.1 展示位置

- 在工作空间左侧导航中增加“最近访问”区域：
  - 类似收藏区域，但按时间排序；
  - 显示页面图标和标题；
  - 可结合标签/集合颜色作为辅助信息。

### 2.2 列表行为

- 点击某项：
  - 跳转到对应的 `/workspace/:workspaceId/:pageId` 页面；
  - 并更新该项的 `visitedAt`（使其成为最新一项）。
- 悬停交互：
  - 显示完整标题和最近访问时间；
  - 可选：显示所属集合/标签等更多信息。

### 2.3 清理操作

- 在最近访问列表中提供：
  - 清空全部记录的入口；
  - 移除单条记录的操作（如右键菜单或删除按钮）。

---

## 3. 与现有实现的呼应

### 3.1 工作空间级“最近使用”示例

- 在 `workspace/index.tsx` 中，存在“最近使用工作空间 ID”的实现：

```ts
// 当 workspace 存在时，更新 localStorage
localStorage.setItem('last_workspace_id', requestedWorkspaceId);
```

- 并在启动时从本地数据中选取推荐工作空间：
  - 通过 `cleanupInvalidWorkspaceStorage` 清理无效数据；
  - 通过 `getRecommendedWorkspaceId` 选择合适的 workspace。

这一模式可以推广到页面级：

- 为每个 workspace 维护一个“最近访问页面”的本地记录；
- 或由后端统一管理所有页面的最近访问列表。

### 3.2 与收藏的区别和配合

- 收藏更偏向“用户主动标记的长期常用页面”；
- 最近访问则偏向“短期内频繁访问的页面”；
- 两者可以在 UI 上分别展示，也可以合并为“常用”视图：
  - 将收藏和最近访问的页面合并，按一定规则排序；
  - 例如：收藏优先，然后按最近访问时间排序。

---

## 4. 实现建议（占位）

> 当前代码库中没有完整显式的“最近访问页面列表”实现，本节给出实现建议，后续可作为开发参考。

- 前端本地实现（简单版）：
  - 使用 `localStorage` 记录最近访问列表（按 workspace 分桶）；
  - 在页面加载成功后更新本地记录；
  - 在侧边栏组件中读取并展示；
  - 适合本地/单人使用场景。

- 后端驱动实现（进阶版）：
  - 每次访问页面时通过 API 上报访问事件；
  - 服务端维护“最近访问”记录，支持跨设备/跨客户端同步；
  - 前端通过分页接口加载最近访问列表；
  - 更适合多人协作、云端场景。 
