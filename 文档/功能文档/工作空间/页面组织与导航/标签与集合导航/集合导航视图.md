# 集合导航视图（功能 + 实现说明）

> 关联上级：`工作空间/页面组织与导航/标签与集合导航.md`  
> 相关代码位置：
> - 集合列表组件：`packages/frontend/core/src/components/page-list/collections/*`
> - 列表渲染器：`page-group.tsx` 内 `CollectionListItemRenderer`

---

## 1. 集合展示

### 1.1 集合元数据

- 每个集合（CollectionMeta）通常包含：
  - `id`：集合 ID；
  - `title`：集合名称；
  - `description`：集合描述（可选）；
  - `pageCount`：包含页面数量（可选，由后端计算）。

### 1.2 列表渲染器

- 在 `page-group.tsx` 中，`CollectionListItemRenderer` 将集合元数据转换为列表行：

```tsx
export const CollectionListItemRenderer = memo((item: ListItem) => {
  const props = useAtomValue(listsPropsAtom);
  const { selectionActive } = useAtomValue(selectionStateAtom);
  const collection = item as CollectionMeta;
  return (
    <CollectionListItem
      {...collectionMetaToListItemProp(collection, {
        ...props,
        selectable: !!selectionActive,
      })}
    />
  );
});
```

- `collectionMetaToListItemProp` 负责将 `CollectionMeta` 映射为 `CollectionListItemProps`：

```ts
const itemProps: CollectionListItemProps = {
  collectionId: item.id,
  title: item.title,
  to:
    props.rowAsLink && !props.selectable
      ? `/collection/${item.id}`
      : undefined,
  onClick: toggleSelection,
  icon: <ViewLayersIcon />,
  operations: props.operationsRenderer?.(item),
  selectable: props.selectable,
  selected: props.selectedIds?.includes(item.id),
  onSelectedChange: toggleSelection,
  draggable: props.draggable,
};
```

- 展示内容：
  - 集合名称；
  - 集合图标（例如 `ViewLayersIcon`）；
  - 可扩展显示集合描述、页面数量等。

---

## 2. 集合导航交互

### 2.1 点击行为

- 在非多选模式下：

```ts
to: props.rowAsLink && !props.selectable ? `/collection/${item.id}` : undefined,
```

- 说明：
  - 当 `rowAsLink` 为 `true` 且当前不处于“选择模式”时，点击集合行会跳转到集合详情页；
  - 集合详情页路由为：`/workspace/:workspaceId/collection/:collectionId`（或 `/:workspaceId/collection` 视路由配置）。
- 集合详情页中：
  - 展示该集合下所有页面；
  - 支持按时间、标题、标签等进一步筛选与排序。

### 2.2 集合内容管理（添加/移除页面）

- 在集合详情页或页面属性区域：
  - 用户可以将页面加入某个集合；
  - 或从集合中移除页面；
- 典型交互：
  - 在页面属性面板中选择集合；
  - 在集合视图中勾选/取消某页面；
  - 拖拽页面到集合节点上（视实现）。

### 2.3 多选与批量操作

- 与标签列表类似，当进入“选择模式”时：
  - 点击集合行不再跳转，而是切换选中状态；
  - 可对多个集合执行批量操作（如批量删除、调整可见性等，视具体需求）。

---

## 3. 排序与分组（设计）

### 3.1 排序策略

- 集合列表可按以下维度排序：
  - 集合名称（字母顺序）；
  - 创建时间/更新时间；
  - 页面数量。

实现上可以复用 `page-list` 中的排序机制（`sorterAtom` + `ListHeaderCell`）。

### 3.2 分组展示（可选）

- 如果集合很多，可以按类别/标签等分组展示：
  - 比如“系统集合”和“用户自建集合”分组；
  - 或按业务类型划分（项目/客户/知识库等）。

> 当前代码片段中展示的是最基础的集合列表渲染器，分组与排序逻辑可以在列表容器层扩展。 
