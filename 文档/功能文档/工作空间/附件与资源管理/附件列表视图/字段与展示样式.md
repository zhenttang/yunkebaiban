# 字段与展示样式（功能 + 实现说明）

> 关联上级：`工作空间/附件与资源管理/附件列表视图.md`  
> 相关代码位置：
> - 附件详细页：`packages/frontend/core/src/desktop/pages/workspace/attachment/index.tsx`
> - 附件块模型：`AttachmentBlockModel`（`@blocksuite/yunke/model`）
> - 附件预览组件：`AttachmentViewerView`（`@yunke/core/blocksuite/attachment-viewer`）

---

## 1. 附件记录字段（从块模型到列表字段）

### 1.1 单个附件的基础字段

以 `AttachmentBlockModel` 为例，每个附件块至少包含以下属性：

- `id`：块 ID（同时用作附件路由中的 `attachmentId`）；
- `props.name`：文件名；
- `props.type`：MIME 类型（如 `application/pdf`、`image/png` 等）；
- `props.size`：文件大小（通常以字节为单位，视模型而定）；
- 其他元信息：
  - 上传时间；
  - 上传者/编辑者；
  - 所在页面 ID（`pageId`）。

在附件详情页面中，头部就使用了部分字段，例如：

```tsx
<ViewTitle title={model.props.name} />
<ViewIcon icon={model.props.type.endsWith('pdf') ? 'pdf' : 'attachment'} />
```

### 1.2 附件列表中的列（设计）

在“附件列表视图”中，通常需要展示以下列（可配置显示/隐藏）：

- 文件名（name）：
  - 作为主列；
  - 点击可打开附件详情或所在页面。
- 类型（type）：
  - 使用 MIME 类型映射到“文档/图片/PDF/音频”等语义标签；
  - 同时用图标显示（如 PDF 图标、图片图标）。
- 大小（size）：
  - 使用友好格式显示（KB/MB）；
  - 支持按大小排序。
- 所属页面（page）：
  - 显示所属页面标题；
  - 点击可跳转到该页面。
- 上传时间（uploadedAt）：
  - 显示上传/创建时间；
  - 支持按时间排序。

---

## 2. 展示样式：表格 + 缩略图

### 2.1 表格视图

- 默认视图通常为表格形式：
  - 每行对应一个附件；
  - 各列对应文件名、类型、大小等字段；
  - 支持表头排序（点击某列标题切换升序/降序），可复用 `page-list` 的表头组件与 `sorterAtom` 机制。

功能特点：

- 适合同时查看大量附件；
- 便于按某个字段排序或筛选（如筛选所有 PDF、排序找出最大的附件）。

### 2.2 缩略图视图（主要针对图片类附件）

- 对于图片类附件，提供缩略图视图可以更直观：
  - 每个附件以卡片形式展示；
  - 卡片上显示缩略图、文件名和简单信息；
  - 支持点击放大预览。

实现思路：

- 通过判断 `props.type` 前缀是否为 `image/` 来决定是否启用缩略图；
- 使用 CSS Grid/Flex 实现自适应网格布局；
- 对非图片类附件，可以使用统一的图标卡片形式展示。

---

## 3. 列表与详情视图的联动

### 3.1 列表到详情的跳转

- 在“附件列表视图”中，点击某个附件：
  - 跳转到附件详情路由：

    ```txt
    /workspace/:workspaceId/:pageId/attachments/:attachmentId
    ```

  - 对应组件为 `AttachmentPage`：

    ```tsx
    export const Component = () => {
      const { pageId, attachmentId } = useParams();

      if (pageId && attachmentId) {
        return <AttachmentPage pageId={pageId} attachmentId={attachmentId} />;
      }
      return <PageNotFound noPermission />;
    };
    ```

### 3.2 附件详情页中的字段展示

- 在 `AttachmentPage` 中，通过 `useLoadAttachment` hook 加载数据：
  - 先用 `DocsService` 打开文档；
  - 然后通过 `doc.blockSuiteDoc.getModelById<AttachmentBlockModel>(attachmentId)` 获取附件模型；
  - 根据模型属性设置标题和图标，再交给 `AttachmentViewerView` 渲染。

示例：

```tsx
if (doc && model) {
  return (
    <FrameworkScope scope={doc.scope}>
      <ViewTitle title={model.props.name} />
      <ViewIcon
        icon={model.props.type.endsWith('pdf') ? 'pdf' : 'attachment'}
      />
      <AttachmentViewerView model={model} />
    </FrameworkScope>
  );
}
```

- 列表和详情之间的字段（如 name、type）保持一致，形成完整闭环：  
  列表 → 点击 → 详情 → 再返回列表。

---

## 4. 与过滤/排序的关系（设计）

- 过滤：
  - 按类型过滤（只看图片、只看 PDF 等）；
  - 按所属页面或标签过滤（只看某页面或某集合下的附件）。
- 排序：
  - 按上传时间排序（最新/最旧）；
  - 按大小排序（最大/最小）；
  - 按名称排序。

实现上可以依托已有的列表基础设施（类似 `page-list` 的 sorter/filters 模式），复用同一套 UI 组件和状态管理。 
