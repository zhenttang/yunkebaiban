# 用户与收藏（功能 + 实现说明）

> 关联上级：`文档/功能文档/forum.md`  
> 主要相关代码：
> - 用户主页：`packages/frontend/core/src/desktop/pages/workspace/forum/user-profile/index.tsx`
> - 我的收藏：`packages/frontend/core/src/desktop/pages/workspace/forum/my-collections/index.tsx`
> - 收藏与积分 API：`packages/frontend/core/src/desktop/pages/workspace/forum/forum-api.ts`

---

## 1. 用户主页（/forum/user/:userId）

> 细节见子文档：`论坛/用户与收藏/用户主页视图.md`

- 功能视角：
  - 展示论坛用户的基础信息与积分状态；
  - 展示发帖/回复数量等统计信息；
  - 支持“签到”操作，增加积分与连续签到天数（目前用于演示积分体系）。

- 实现要点：
  - 使用 `getUserPoints(userId)` 拉取 `UserPointDTO`：
    - `totalPoints`、`level`、`postCount`、`replyCount`、`reputation`、`continuousSignInDays` 等；
  - 本地计算等级与进度条（每 100 分升 1 级）；
  - 通过 `signIn(userId)` 实现“每日签到”，更新积分和连续签到天数；
  - 通过本地 `yunke-user-id` 判断是否为当前登录用户，从而控制签到按钮显示与否。

---

## 2. 我的收藏（/forum/my-collections）

> 细节见子文档：`论坛/用户与收藏/收藏功能.md`

- 功能视角：
  - 展示当前用户收藏的帖子列表；
  - 支持按收藏时间查看历史收藏；
  - 支持在列表中直接“取消收藏”；
  - 支持从列表点击进入帖子详情。

- 实现要点：
  - 使用 `getMyCollections(page, size)` 获取 `PaginatedResponse<MyCollectionItemDTO>`：
    - 每条数据包含 `post: PostDTO` 和 `collectedAt` 时间；
  - 列表项展示：
    - 帖子标题、内容摘要、作者、创建时间、收藏时间；
  - 取消收藏操作：
    - 调用 `uncollectPost(post.id)`；
    - 成功后重新加载当前页收藏列表；
    - 为避免误触，使用 `e.stopPropagation()` 阻止点击“取消收藏”时触发整行的跳转行为。

> 收藏入口由帖子详情页的 `PostActions` 组件提供；“我的收藏”则是从当前用户视角汇总已收藏帖子的统一视图。 
