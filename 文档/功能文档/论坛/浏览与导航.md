# 浏览与导航（功能 + 实现说明）

> 关联上级：`文档/功能文档/forum.md`  
> 主要代码位置：
> - 论坛首页：`packages/frontend/core/src/desktop/pages/workspace/forum/forum-home/index.tsx`
> - 板块详情：`packages/frontend/core/src/desktop/pages/workspace/forum/forum-detail/index.tsx`
> - 帖子详情：`packages/frontend/core/src/desktop/pages/workspace/forum/post-detail/index.tsx`
> - API 层：`packages/frontend/core/src/desktop/pages/workspace/forum/forum-api.ts`

---

## 1. 论坛首页（/forum）

> 细节见子文档：`论坛/浏览与导航/论坛首页与板块浏览.md`

- 功能视角：
  - 展示所有板块的树状结构（支持父子板块）；
  - 显示每个板块的名称、描述、帖子数、主题数、最后活跃时间等；
  - 提供搜索框，可按名称/描述过滤板块；
  - 点击任意板块跳转到板块详情页（`/forum/:forumId`）。
- 实现要点：
  - 使用 `listForums()` API 获取板块树（支持多级 children）；
  - 使用 `ForumTreeNode` 组件递归渲染板块树，支持展开/折叠与键盘可访问性；
  - 使用本地 `query` 状态对板块列表进行前端过滤；
  - 使用 `ViewBody` 包裹整个页面，遵循工作台统一布局。

---

## 2. 板块详情（/forum/:forumId）

- 功能视角：
  - 展示单个板块的基础信息（名称、描述）；
  - 展示板块统计（帖子数、主题数、今日发帖、活跃用户数等）；
  - 展示该板块下的帖子列表，支持分页；
  - 提供“发帖”按钮进入发帖页面（`/forum/:forumId/create-post`）。
- 实现要点：
  - 通过 `useParams` 读取 `forumId`，在 `useEffect` 中并行请求：
    - `getForum(id)`：板块基本信息；
    - `getForumStats(id)`：统计信息；
    - `getForumPosts(id, page, 20)`：分页帖子列表。
  - 帖子列表行展示：
    - 标题前使用 `[置顶]`、`[精华]` 文案标记 `isSticky` / `isEssence` 帖子；
    - 显示作者、创建日期、浏览数、回复数；
    - 点击行跳转到 `/forum/:forumId/post/:postId`。
  - 分页：
    - 本地维护 `page` 状态；
    - 使用 `posts.totalPages` 控制上一页/下一页按钮的禁用状态；
    - 切换页码重新请求 `getForumPosts`。

---

## 3. 帖子详情（/forum/:forumId/post/:postId）

> 细节见子文档：`论坛/浏览与导航/帖子详情浏览.md`

- 功能视角：
  - 展示帖子标题、作者、发布时间、浏览数、回复数等主信息；
  - 展示帖子正文（支持 HTML 渲染与基本清洗）；
  - 展示帖子标签与附件列表；
  - 提供点赞、收藏、版主操作（置顶、加精、锁定、查看编辑历史）；
  - 展示回复列表和时间线，并支持回复、点赞回复、标记最佳答案。
- 实现要点：
  - 使用一组 API 获取帖子的完整信息：
    - `getPost(postId)`：帖子主信息；
    - `getPostTags(postId)`：标签列表；
    - `getPostAttachments(postId)`：附件列表；
    - `getPostReplies(postId, page, size)`：分页回复列表。
  - 使用 `PostActions` 组件处理帖子的点赞与收藏逻辑；
  - 使用 `usePermission` hook 判断当前用户是否具备版主权限，从而显示/隐藏管理按钮；
  - 使用 `ReplyList` 组件渲染回复列表，并通过回调处理点赞与“最佳答案”标记；
  - 使用 `useToast` Hook 展示错误与成功提示。

> 通过这三类页面的组合，论坛模块构成了一个完整的「从板块树 → 板块帖子列表 → 帖子详情与互动」的浏览与导航路径。 
