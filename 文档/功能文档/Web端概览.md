# Web 桌面端功能大纲

> 状态：大纲草稿。这里重点从「功能视角」列出 Web 前端（`packages/frontend/apps/web` + `@yunke/core/desktop`）已有的功能模块，后续会在独立文档中逐项展开实现细节。

---

## 1. 顶层路由与整体导航

### 1.1 应用入口与根路由

- `/`
  - 作为整个 Web 前端的默认入口。
  - 未登录用户：展示登录/注册入口、产品介绍、引导按钮。
  - 已登录用户：根据有无工作空间，跳转到最近使用的 workspace 或工作空间选择页。
  - 处理基础的重定向逻辑（例如带 `redirect_uri` 的登录后跳转）。
- `*`
  - 所有未匹配路由的兜底处理。
  - 提示“页面不存在”，并提供返回首页 / 工作空间首页的操作。

### 1.2 下载与客户端集成

- `/download`
  - 展示桌面客户端的下载信息（Windows / macOS）。
  - 典型内容：下载按钮、系统要求说明、安装步骤简述。
- `/download-mobile`
  - 展示移动端下载链接（Android / iOS）。
  - 典型内容：二维码、应用商店链接、APK 下载等。
- `/open-app/:action`
  - 从浏览器唤起本地客户端，例如：
    - 打开指定文档/工作空间；
    - 处理桌面端登录配对（配合 `/desktop-signin`）。
  - 当本地客户端不可用时，提供回退方案（如继续使用 Web 版）。

### 1.3 引导、跳转与状态页

- `/onboarding`
  - 第一次使用时的引导流程：
    - 介绍核心概念：工作空间、文档、白板、数据库、AI 等；
    - 引导创建第一个工作空间/文档；
    - 可能带有进度步骤条和跳过按钮。
- `/redirect-proxy`
  - 作为中转路由使用，用于处理：
    - 第三方跳转返回后的统一逻辑；
    - 一些带复杂查询参数的重定向处理。
- `/invite/:inviteId`
  - 处理邀请链接：
    - 未登录时：先引导登录，再加入对应工作空间/团队；
    - 已登录时：直接加入并跳转到目标工作空间/页面。
- `/expired`
  - 用于展示各种“过期状态”：
    - 邀请链接过期；
    - 分享链接过期；
    - 订阅到期等。
  - 通常会提供：返回首页、联系管理员/支持、重新发起邀请等按钮。
- `/404`
  - 显式 404 页面（与通用兜底不同，可以直接访问）。
  - 提示找不到页面，并提供导航回首页或最近的工作空间。

---

## 2. 工作空间（Workspace）系统

> 路由前缀：`/workspace/:workspaceId/*`  
> 主要目录：`packages/frontend/core/src/desktop/pages/workspace/*` + `components/page-list/*` + `components/workspace-*` + `components/properties/*`

### 2.1 工作空间入口与布局

- 工作空间主入口页面
  - `/workspace/:workspaceId/` 根布局。
  - 结构通常为：左侧导航栏 + 顶部栏 + 中间主编辑区 + 可选右侧属性栏。
- 工作空间选择与切换
  - 工作空间列表：
    - 显示当前账户下可访问的所有工作空间（个人、团队、自建）。
    - 支持搜索/筛选（如按名称或标记）。
  - 最近访问工作空间：
    - 在列表顶部展示最近使用的工作空间。
  - 创建/加入工作空间：
    - 提供「新建工作空间」「通过邀请加入工作空间」入口。

### 2.2 文档与白板编辑

- 文档详情页
  - 块级编辑：
    - 支持多种 Block（段落、标题、列表、Callout、代码块、表格、数据库等）。
    - 支持拖拽调整块顺序、缩进/出缩进、复制/删除块。
  - 文档属性：
    - 标题、图标、封面；
    - 标签、集合归属、创建时间、最后修改时间；
    - 作者/协作者信息。
  - 历史与统计：
    - 页面历史记录入口（版本回溯）；
    - 文档统计（字数、阅读量等，具体以实现为准）。
- 白板 / 画布模式
  - Edgeless 模式：
    - 支持在无限画布上插入文本、形状、连接线、贴纸等。
    - 支持缩放、平移、多选、对齐等操作。
  - 图形与流程图：
    - 插入流程节点、箭头、泳道等。
    - 支持 Mermaid / drawio / 流程图块的可视化编辑。
- 数据库 / 表格视图
  - 数据库块：
    - 支持表格、看板、画廊等多种视图。
    - 每行作为一条记录，可打开为单独页面或侧边详情。
  - 字段类型：
    - 文本、数字、日期、成员、多选、文件、关联等。
  - 视图配置：
    - 筛选条件、排序规则、分组规则（如按成员、按状态）。

### 2.3 页面组织与导航

- 页面树 / 导航侧边栏
  - 文档结构树：
    - 展示当前工作空间中的所有页面，按层级组织。
    - 支持折叠/展开子层级。
  - 节点操作：
    - 新建页面/子页面；
    - 重命名、删除、移动到其他集合；
    - 拖拽调整顺序或层级。
- 收藏与置顶
  - 收藏能力：
    - 对重要页面进行收藏；
    - 收藏列表常驻侧边栏顶部。
  - 置顶能力：
    - 允许将页面置顶于特定分区（如快捷访问区）。
- 标签与集合
  - 标签：
    - 为页面打标签；
    - 可在标签视图中按标签筛选页面。
  - 集合（Collection）：
    - 将一组相关页面归为集合；
    - 集合本身可以有图标/描述等属性。

### 2.4 全局视图（列表页）

- 全部页面列表
  - 路由：
    - 对应 `/workspace/:workspaceId/all-page` 相关页面。
  - 功能：
    - 按名称搜索页面；
    - 按标签、集合、更新时间等条件筛选；
    - 支持分页或懒加载。
- 全部标签列表
  - 展示当前工作空间下所有标签；
  - 每个标签显示对应的页面数；
  - 支持点击标签直接跳转到「按标签过滤的页面列表」。
- 全部集合列表
  - 列出所有集合及其包含的页面数量；
  - 支持创建、编辑、删除集合；
  - 通过集合快速跳转到相应的页面视图。

### 2.5 附件与资源管理

- 附件列表视图
  - 展示当前工作空间内所有附件（图片、音频、视频、PDF、Office 文件等）；
  - 支持按类型、上传时间、所属页面等筛选；
  - 支持按大小或名称排序。
- 附件预览与操作
  - 预览：
    - 图片预览、PDF 内嵌预览、音频播放、文本查看等。
  - 操作：
    - 下载、重命名、删除；
    - 打开所在页面；
    - 复制链接（若启用外链）。

### 2.6 分享与访问控制

- 分享链接管理
  - 从页面/工作空间中生成分享链接；
  - 支持设置访问级别：
    - 公开（持有链接即可访问）；
    - 仅团队成员可访问；
    - 仅受邀成员可访问。
  - 可设置过期时间、密码（如果后端支持）。
- 分享访问入口
  - `/share/:workspaceId/:pageId`：
    - 通过分享链接访问时，自动重定向到对应 workspace/page；
    - 未登录用户可能需要登录后再进入。
- 协同编辑
  - 多人同时编辑同一页面；
  - 显示其他协作者的光标、选择区域；
  - 冲突处理和实时同步由底层同步引擎负责。

### 2.7 工作空间设置

- 基础设置
  - 设置工作空间名称、图标、封面；
  - 配置默认首页/默认视图；
  - 选择默认语言、时区。
- 成员与权限
  - 成员列表：
    - 展示所有成员及其角色（所有者、管理员、普通成员、访客等）。
  - 邀请成员：
    - 通过邮箱邀请；
    - 生成邀请链接（配合 `/invite/:inviteId`）。
  - 权限管理：
    - 配置成员在工作空间内的操作权限（编辑/只读/禁止访问等）。
- 高级设置
  - 存储与配额：
    - 展示当前工作空间的存储使用情况；
    - 在超容量时提示 over-capacity 状态。
  - 云同步与备份：
    - 启用/禁用云同步（依据部署方案）；
    - 查看/管理备份策略（具体见实现文档）。

---

## 3. 论坛与社区功能

> 路由前缀：`/forum`  
> 主要目录：`packages/frontend/core/src/desktop/pages/workspace/forum/*`、`components/community-ui/*`

### 3.1 论坛浏览

- `/forum`
  - 论坛首页，展示推荐板块和帖子
- `/forum/:forumId`
  - 某个论坛（看板）的详情页
- 帖子详情
  - `/forum/:forumId/post/:postId`
  - 查看帖子内容、回复、评论等

### 3.2 帖子创作与管理

- 发帖
  - `/forum/:forumId/create-post`
  - 标题、内容、标签等
- 草稿管理
  - `/forum/drafts`
  - 草稿列表、继续编辑、删除草稿
- 编辑历史
  - `/forum/posts/:postId/history`
  - 查看某个帖子的编辑记录

### 3.3 标签与搜索

- 标签视图
  - `/forum/tags/:tagId`
  - 查看某标签下的所有帖子
- 搜索结果
  - `/forum/search`
  - 按标题/内容/标签搜索帖子

### 3.4 用户视图与收藏

- 用户主页
  - `/forum/user/:userId`
  - 查看某用户的发帖、资料等
- 我的收藏
  - `/forum/my-collections`
  - 收藏的帖子列表

### 3.5 通知与管理

- 通知中心
  - `/forum/notifications`
  - 帖子回复、@ 提及、系统通知等
- 版主面板
  - `/forum/moderator`
  - 审核、管理帖子、管理用户等操作

---

## 4. 模板中心与剪藏集成

> 主要目录：`packages/frontend/core/src/desktop/pages/import-clipper`、`import-template` 等

### 4.1 模板中心

- 模板导入
  - `/template/import`
  - 从模板库/外部导入模板到当前工作空间
- 模板预览
  - `/template/preview`
  - 根据 URL 参数（workspaceId、docId、templateName 等）预览模板
  - 预览后重定向到实际 workspace 文档

### 4.2 剪藏集成

- 剪藏导入
  - `/clipper/import`
  - 从浏览器剪藏插件、第三方剪藏工具导入内容
- 剪藏内容落地
  - 将剪藏内容转换为文档或块，插入到指定工作空间/页面

---

## 5. 认证与登录功能

> 主要目录：`packages/frontend/core/src/desktop/pages/auth/*`、`components/sign-in/*`

### 5.1 通用认证入口

- `/auth/:authType`
  - 根据 `authType` 区分不同认证流程（如登录、注册、绑定等）

### 5.2 登录方式

- 普通登录页
  - `/sign-in`、`/signIn`
  - 账号密码 / 邮箱验证码登录（具体逻辑见实现文档）
- Magic Link 登录
  - `/magic-link`
  - 邮件中的魔法链接一键登录
- OAuth 登录
  - `/oauth/login`
    - 跳转到第三方认证页面
  - `/oauth/callback`
    - 第三方登录完成后的回调处理
- 桌面端登录协同
  - `/desktop-signin`
  - 为桌面客户端提供 Web 登录配对入口

### 5.3 登录状态与登出

- 登录状态检测
  - 应用启动时校验当前用户登录状态
- 退出登录
  - 顶部/侧边栏登出入口
  - 清理本地状态并返回登录页

---

## 6. 订阅、升级与计费相关页面

> 主要目录：`packages/frontend/core/src/desktop/pages/subscribe`、`upgrade-success/*`、`ai-upgrade-success`、`upgrade-to-team`

### 6.1 订阅入口

- `/subscribe`
  - 展示可用套餐、价格和订阅选项
- `/try-cloud`
  - 引导用户试用云端部署（内部重定向到登录并携带参数）

### 6.2 升级结果页面

- 普通升级成功
  - `/upgrade-success`
- 团队版本升级成功
  - `/upgrade-success/team`
- 自建团队版升级成功
  - `/upgrade-success/self-hosted-team`
- AI 功能升级成功
  - `/ai-upgrade-success`

### 6.3 从个人到团队

- `/upgrade-to-team`
  - 引导个人用户升级为团队版
  - 可能包含成员邀请、权限设置等后续步骤入口

---

## 7. 主题、外观与体验增强

> 主要目录：`packages/frontend/core/src/desktop/pages/theme-editor`、`root/custom-theme` 等

### 7.1 主题编辑器

- `/theme-editor`
  - 可视化配置界面主题、颜色、字体等

### 7.2 自定义主题支持

- 根级自定义主题页面
  - `root/custom-theme`
  - 配合主题 Provider，实现全局主题切换

### 7.3 全局体验增强

- 全局加载指示
  - `root/global-loading` 等组件
- 页面内查找
  - `root/find-in-page` 相关能力
- 错误边界与错误页
  - `yunke-error-boundary` 组件
  - Web 入口层级的错误兜底 UI

---

> 后续计划：  
> - 将本大纲拆分为更细的子文档（如「工作空间功能详解」「论坛功能详解」「认证与登录详解」等）。  
> - 在每一小节下补充：用户视角的功能说明、对应路由和组件列表、核心交互流程图、关键实现思路与代码路径。  
> - 确保随着代码演进同步更新本大纲，作为前端功能的“总目录”。
