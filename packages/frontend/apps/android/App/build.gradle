buildscript {
    repositories {
        // 官方仓库优先（插件下载）
        google()
        mavenCentral()
        gradlePluginPortal()
        // 阿里云镜像备选
        maven { url 'https://maven.aliyun.com/repository/google' }
        maven { url 'https://maven.aliyun.com/repository/central' }
        maven { url 'https://maven.aliyun.com/repository/gradle-plugin' }
    }
    dependencies {
        classpath libs.android.gradle.plugin
        // classpath libs.google.services  // 禁用Google Services
    }
}

plugins {
    alias libs.plugins.gradle.versions
    alias libs.plugins.version.catalog.update
    alias libs.plugins.android.application apply false
    alias libs.plugins.android.library apply false
    alias libs.plugins.compose apply false
    // alias libs.plugins.firebase.crashlytics apply false  // 禁用Firebase
    // alias libs.plugins.google.service apply false  // 禁用Google Services
    alias libs.plugins.hilt apply false
    alias libs.plugins.jetbrains.kotlin.jvm apply false
    alias libs.plugins.kotlin.android apply false
    alias libs.plugins.kotlin.parcelize apply false
    alias libs.plugins.kotlin.serialization apply false
    alias libs.plugins.ksp apply false
    // alias libs.plugins.rust.android apply false  // 已禁用Rust
}

apply from: "variables.gradle"
apply from: "${project.rootDir}/buildscripts/toml-updater-config.gradle"

allprojects {
    repositories {
        // 阿里云镜像（国内加速）
        maven { url 'https://maven.aliyun.com/repository/google' }
        maven { url 'https://maven.aliyun.com/repository/central' }
        maven { url 'https://maven.aliyun.com/repository/gradle-plugin' }
        google {
            content {
                includeGroupByRegex("com\\.android.*")
                includeGroupByRegex("com\\.google.*")
                includeGroupByRegex("androidx.*")
            }
        }
        mavenCentral()
        gradlePluginPortal()
    }
}

// 强制所有模块使用 Java 17
subprojects {
    afterEvaluate { project ->
        if (project.hasProperty('android')) {
            android {
                compileOptions {
                    sourceCompatibility JavaVersion.VERSION_17
                    targetCompatibility JavaVersion.VERSION_17
                }
            }
        }
    }
}
